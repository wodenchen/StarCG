<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ˜Ÿè© éª°å¯¶è¶¨å‹¢åˆ†æå™¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        html {
            -webkit-text-size-adjust: 100%;
        }

        body {
            font-family: 'Microsoft JhengHei', 'PingFang TC', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            color: #fff;
            padding: 20px;
            font-size: 18px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            font-size: 2.5rem;
            margin-bottom: 30px;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
            color: #ffd700;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        @media (max-width: 1024px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .card h2 {
            color: #ffd700;
            margin-bottom: 15px;
            font-size: 1.5rem;
            border-bottom: 2px solid rgba(255, 215, 0, 0.3);
            padding-bottom: 10px;
        }

        /* è¼¸å…¥å€åŸŸ */
        .input-section {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
            margin-bottom: 20px;
        }

        .dice-input {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .dice-input label {
            font-weight: bold;
            color: #ffd700;
        }

        .dice-input input {
            width: 70px;
            height: 55px;
            font-size: 1.7rem;
            text-align: center;
            border: 2px solid #ffd700;
            border-radius: 10px;
            background: rgba(0, 0, 0, 0.3);
            color: #fff;
            appearance: textfield;
            -webkit-appearance: textfield;
            -moz-appearance: textfield;
        }
        
        .dice-input input::-webkit-outer-spin-button,
        .dice-input input::-webkit-inner-spin-button {
            appearance: none;
            -webkit-appearance: none;
            margin: 0;
        }

        .dice-input input:focus {
            outline: none;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }

        .btn {
            padding: 14px 28px;
            font-size: 1.1rem;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            touch-action: manipulation;
            appearance: none;
            -webkit-appearance: none;
        }

        .btn-primary {
            background: linear-gradient(135deg, #ffd700, #ff8c00);
            color: #1a1a2e;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(255, 215, 0, 0.4);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ff4757, #ff3838);
            color: #fff;
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.2);
            color: #fff;
            padding: 10px 18px;
            font-size: 0.95rem;
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* ç•¶å‰çµæœé¡¯ç¤º */
        .current-result {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .dice-display {
            width: 60px;
            height: 60px;
            background: #fff;
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2rem;
            font-weight: bold;
            color: #1a1a2e;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .result-type {
            font-size: 1.8rem;
            font-weight: bold;
            padding: 10px 30px;
            border-radius: 10px;
        }

        .result-big { background: linear-gradient(135deg, #e74c3c, #c0392b); color: #fff; }
        .result-small { background: linear-gradient(135deg, #3498db, #2980b9); color: #fff; }
        .result-triple { background: linear-gradient(135deg, #ffd700, #ff8c00); color: #1a1a2e; animation: pulse 1s infinite; }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* æ­·å²è¨˜éŒ„è¡¨æ ¼ */
        .history-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 1.05rem;
        }

        .history-table th,
        .history-table td {
            padding: 10px 6px;
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .history-table th {
            background: rgba(255, 215, 0, 0.2);
            color: #ffd700;
        }

        .history-table tbody tr:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .history-container {
            max-height: 350px;
            overflow-y: auto;
        }

        .badge {
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.95rem;
            font-weight: bold;
        }

        .badge-big { background: #e74c3c; }
        .badge-small { background: #3498db; }
        .badge-triple { background: #ffd700; color: #1a1a2e; }

        /* çµ±è¨ˆå€åŸŸ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 18px;
            text-align: center;
        }

        .stat-card h3 {
            font-size: 1.1rem;
            margin-bottom: 10px;
            color: #aaa;
        }

        .stat-card .value {
            font-size: 2.5rem;
            font-weight: bold;
        }

        .stat-card .percentage {
            font-size: 1rem;
            color: #888;
        }

        /* è¶¨å‹¢åˆ†æ */
        .trend-section {
            margin-bottom: 20px;
        }

        .trend-title {
            font-size: 1.15rem;
            margin-bottom: 10px;
            color: #ffd700;
        }

        .trend-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 10px;
        }

        .trend-item {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 12px 5px;
            text-align: center;
        }

        .trend-item .number {
            font-size: 1.4rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .trend-item .count {
            font-size: 0.95rem;
            color: #888;
        }

        .trend-item .status {
            font-size: 0.85rem;
            padding: 3px 8px;
            border-radius: 10px;
            margin-top: 5px;
            display: inline-block;
        }

        .hot { background: #e74c3c; }
        .warm { background: #f39c12; }
        .cold { background: #3498db; }

        /* æŠ•æ³¨å»ºè­° */
        .strategy-toggle {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .strategy-btn {
            flex: 1;
            padding: 18px;
            border: 2px solid transparent;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            font-size: 1.1rem;
        }

        .strategy-btn.conservative { background: rgba(52, 152, 219, 0.3); color: #3498db; }
        .strategy-btn.aggressive { background: rgba(231, 76, 60, 0.3); color: #e74c3c; }
        .strategy-btn.active { border-color: currentColor; transform: scale(1.02); }

        .strategy-desc {
            font-size: 0.8rem;
            font-weight: normal;
            margin-top: 5px;
            opacity: 0.8;
        }

        .strategy-explain {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            font-size: 1rem;
            line-height: 1.7;
            display: none;
        }

        .strategy-explain.show { display: block; }
        .strategy-explain .title { color: #ffd700; font-weight: bold; margin-bottom: 8px; }
        .strategy-explain ul { margin: 0; padding-left: 20px; color: #ccc; }
        .strategy-explain li { margin-bottom: 4px; }

        .bet-suggestion {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 10px;
            padding: 20px;
            font-size: 1.05rem;
        }

        .bet-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 14px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .bet-item:last-child { border-bottom: none; }
        .bet-item .bet-type { font-weight: bold; font-size: 1.2rem; }
        .bet-item .bet-amount { color: #ffd700; font-weight: bold; font-size: 1.15rem; }
        .bet-item .bet-odds { color: #888; font-size: 0.95rem; }

        .total-bet {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 2px solid rgba(255, 215, 0, 0.3);
            display: flex;
            justify-content: space-between;
            font-size: 1.2rem;
            font-weight: bold;
        }

        .total-bet .amount { color: #ffd700; }

        .confidence-meter {
            margin-top: 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 10px;
        }

        .confidence-meter label { display: block; margin-bottom: 8px; color: #888; }
        .meter-bar { height: 20px; background: rgba(255, 255, 255, 0.1); border-radius: 10px; overflow: hidden; }
        .meter-fill { height: 100%; border-radius: 10px; transition: width 0.5s; }
        .meter-low { background: linear-gradient(90deg, #3498db, #2ecc71); }
        .meter-medium { background: linear-gradient(90deg, #f39c12, #e74c3c); }
        .meter-high { background: linear-gradient(90deg, #e74c3c, #8e44ad); }

        .confidence-detail {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 10px;
            padding: 18px;
            margin-top: 10px;
            border: 1px solid rgba(255, 215, 0, 0.3);
        }

        .confidence-detail .detail-title { color: #ffd700; font-weight: bold; margin-bottom: 12px; font-size: 1.1rem; }
        .confidence-detail .detail-content { font-size: 1rem; color: #ccc; }
        .confidence-detail .detail-table { width: 100%; margin: 10px 0; }
        .confidence-detail .detail-table td { padding: 8px 0; border-bottom: 1px solid rgba(255, 255, 255, 0.1); }
        .confidence-detail .detail-table .val { text-align: right; color: #2ecc71; font-weight: bold; }

        .confidence-levels { display: flex; gap: 12px; margin-top: 15px; flex-wrap: wrap; }
        .confidence-levels .level { padding: 6px 14px; border-radius: 15px; font-size: 0.95rem; }
        .confidence-levels .low { background: rgba(52, 152, 219, 0.3); color: #3498db; }
        .confidence-levels .medium { background: rgba(243, 156, 18, 0.3); color: #f39c12; }
        .confidence-levels .high { background: rgba(231, 76, 60, 0.3); color: #e74c3c; }

        /* è·¯å–®é¡¯ç¤º */
        .roadmap { display: flex; flex-wrap: wrap; gap: 5px; margin-top: 15px; }
        .roadmap-cell {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 0.9rem;
            font-weight: bold;
            cursor: pointer;
        }

        .roadmap-big { background: #e74c3c; }
        .roadmap-small { background: #3498db; }
        .roadmap-triple { background: #ffd700; color: #1a1a2e; }

        /* è³ ç‡èªªæ˜ */
        .odds-info {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 15px;
            padding: 18px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
        }

        .odds-item { text-align: center; }
        .odds-item .type { font-size: 1.05rem; color: #888; }
        .odds-item .odds { font-size: 1.35rem; font-weight: bold; color: #ffd700; }

        .warning-text {
            color: #f39c12;
            font-size: 0.9rem;
            margin-top: 10px;
            padding: 10px;
            background: rgba(243, 156, 18, 0.1);
            border-radius: 8px;
            border-left: 3px solid #f39c12;
        }

        /* åŒ¯å…¥åŒ¯å‡º */
        .import-export {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .import-area {
            display: none;
            margin-top: 15px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
        }

        .import-area textarea {
            width: 100%;
            height: 120px;
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid #ffd700;
            border-radius: 8px;
            color: #fff;
            padding: 10px;
            font-family: monospace;
            font-size: 0.95rem;
            resize: vertical;
        }

        .import-area .hint {
            color: #888;
            font-size: 0.85rem;
            margin-top: 8px;
        }

        /* åˆ†æè¦–çª—é¸æ“‡ */
        .window-select {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .window-select select {
            padding: 8px 15px;
            border-radius: 8px;
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid #ffd700;
            color: #fff;
            font-size: 1rem;
        }

        /* ============================================================ */
        /* æ‰‹æ©Ÿç‰ˆéŸ¿æ‡‰å¼è¨­è¨ˆ */
        /* ============================================================ */
        
        @media (max-width: 768px) {
            body {
                padding: 10px;
                font-size: 16px;
            }
            
            h1 {
                font-size: 1.6rem;
                margin-bottom: 15px;
            }
            
            .card {
                padding: 12px;
                border-radius: 10px;
            }
            
            .card h2 {
                font-size: 1.2rem;
                margin-bottom: 10px;
            }
            
            /* è¼¸å…¥å€åŸŸæ‰‹æ©Ÿç‰ˆ */
            .input-section {
                flex-direction: column;
                align-items: stretch;
                gap: 10px;
            }
            
            .dice-input {
                display: flex;
                justify-content: space-between;
                width: 100%;
            }
            
            .dice-input label {
                min-width: 50px;
            }
            
            .dice-input input {
                flex: 1;
                width: auto;
                height: 50px;
                font-size: 1.4rem;
            }
            
            .dice-input input[type="text"] {
                max-width: none;
            }
            
            .btn {
                width: 100%;
                padding: 14px 20px;
                font-size: 1.1rem;
            }
            
            /* ç•¶å‰çµæœæ‰‹æ©Ÿç‰ˆ */
            .current-result {
                padding: 12px;
                gap: 10px;
            }
            
            .dice-display {
                width: 48px;
                height: 48px;
                font-size: 1.5rem;
            }
            
            .result-type {
                font-size: 1.3rem;
                padding: 8px 16px;
            }
            
            /* è³ ç‡èªªæ˜æ‰‹æ©Ÿç‰ˆ */
            .odds-info {
                grid-template-columns: 1fr;
                gap: 8px;
                padding: 12px;
            }
            
            .odds-item {
                display: flex;
                justify-content: space-between;
                align-items: center;
            }
            
            .odds-item .type {
                font-size: 1rem;
            }
            
            .odds-item .odds {
                font-size: 1.1rem;
            }
            
            /* è·¯å–®æ‰‹æ©Ÿç‰ˆ */
            .roadmap {
                gap: 4px;
            }
            
            .roadmap-cell {
                width: 26px;
                height: 26px;
                font-size: 0.75rem;
            }
            
            /* çµ±è¨ˆå€å¡Šæ‰‹æ©Ÿç‰ˆ */
            .stats-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 8px;
            }
            
            .stat-card {
                padding: 10px 5px;
            }
            
            .stat-card h3 {
                font-size: 0.75rem;
            }
            
            .stat-card .value {
                font-size: 1.4rem;
            }
            
            .stat-card .percentage {
                font-size: 0.75rem;
            }
            
            /* è¶¨å‹¢å€å¡Šæ‰‹æ©Ÿç‰ˆ */
            .trend-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 6px;
            }
            
            .trend-item {
                padding: 8px 5px;
                font-size: 0.85rem;
            }
            
            .trend-item .number {
                font-size: 1.2rem;
            }
            
            /* ç¸½å’Œåˆ†å¸ƒæ‰‹æ©Ÿç‰ˆ */
            #sumTrend {
                grid-template-columns: repeat(4, 1fr) !important;
            }
            
            /* ç­–ç•¥åˆ‡æ›æ‰‹æ©Ÿç‰ˆ */
            .strategy-toggle {
                flex-direction: column;
                gap: 10px;
            }
            
            .strategy-btn {
                padding: 12px;
                font-size: 1rem;
            }
            
            .strategy-desc {
                font-size: 0.8rem;
            }
            
            /* ç­–ç•¥èªªæ˜æ‰‹æ©Ÿç‰ˆ */
            .strategy-explain {
                padding: 12px;
                font-size: 0.9rem;
            }
            
            .strategy-explain ul {
                padding-left: 15px;
            }
            
            /* æŠ•æ³¨å»ºè­°æ‰‹æ©Ÿç‰ˆ */
            .bet-suggestion {
                padding: 12px;
            }
            
            .suggestion-item {
                padding: 12px;
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }
            
            .suggestion-item .bet-type {
                font-size: 1.1rem;
            }
            
            .suggestion-item .bet-amount {
                font-size: 1.2rem;
            }
            
            /* ä¿¡å¿ƒæŒ‡æ•¸æ‰‹æ©Ÿç‰ˆ */
            .confidence-meter {
                padding: 12px;
            }
            
            .confidence-levels {
                flex-direction: column;
                gap: 8px;
            }
            
            .confidence-detail {
                font-size: 0.85rem;
                padding: 12px;
            }
            
            /* æ­·å²è¡¨æ ¼æ‰‹æ©Ÿç‰ˆ */
            .history-table {
                font-size: 0.85rem;
            }
            
            .history-table th,
            .history-table td {
                padding: 8px 4px;
            }
            
            .history-table .btn {
                width: auto;
                padding: 5px 10px;
                font-size: 0.8rem;
            }
            
            /* åŒ¯å…¥åŒ¯å‡ºæ‰‹æ©Ÿç‰ˆ */
            .import-export {
                flex-direction: column;
            }
            
            .import-area textarea {
                height: 100px;
                font-size: 0.9rem;
            }
            
            /* åˆ†æè¦–çª—é¸æ“‡æ‰‹æ©Ÿç‰ˆ */
            .window-select {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .window-select select {
                width: 100%;
            }
            
            /* é¾å‹¢åœ–ä¾‹æ‰‹æ©Ÿç‰ˆ */
            .dragon-legend {
                font-size: 0.8rem;
                line-height: 1.6;
            }
        }
        
        /* æ›´å°è¢å¹•ï¼ˆiPhone SE ç­‰ï¼‰*/
        @media (max-width: 375px) {
            body {
                padding: 8px;
                font-size: 14px;
            }
            
            h1 {
                font-size: 1.4rem;
            }
            
            .stats-grid {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .stat-card .value {
                font-size: 1.2rem;
            }
            
            .dice-display {
                width: 42px;
                height: 42px;
                font-size: 1.3rem;
            }
            
            .roadmap-cell {
                width: 22px;
                height: 22px;
                font-size: 0.7rem;
            }
            
            .trend-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            #sumTrend {
                grid-template-columns: repeat(3, 1fr) !important;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ² æ˜Ÿè© éª°å¯¶è¶¨å‹¢åˆ†æå™¨ ğŸ²</h1>

        <div class="main-grid">
            <!-- å·¦å´ï¼šè¼¸å…¥èˆ‡è¨˜éŒ„ -->
            <div>
                <div class="card">
                    <h2>ğŸ“ è¼¸å…¥é–‹ççµæœ</h2>
                    <div class="input-section">
                        <div class="dice-input">
                            <label>æœŸæ•¸:</label>
                            <input type="text" id="roundNum" placeholder="å¦‚:001" style="width: 80px;">
                        </div>
                        <div class="dice-input">
                            <label>éª°1:</label>
                            <input type="number" id="dice1" min="1" max="6" placeholder="1-6" inputmode="numeric" pattern="[1-6]">
                        </div>
                        <div class="dice-input">
                            <label>éª°2:</label>
                            <input type="number" id="dice2" min="1" max="6" placeholder="1-6" inputmode="numeric" pattern="[1-6]">
                        </div>
                        <div class="dice-input">
                            <label>éª°3:</label>
                            <input type="number" id="dice3" min="1" max="6" placeholder="1-6" inputmode="numeric" pattern="[1-6]">
                        </div>
                        <button class="btn btn-primary" onclick="addRecord()">æ–°å¢è¨˜éŒ„</button>
                        <button class="btn btn-danger" onclick="clearRecords()">æ¸…é™¤å…¨éƒ¨</button>
                    </div>

                    <div class="current-result" id="currentResult" style="display: none;">
                        <div style="text-align: center; margin-right: 15px;">
                            <div style="color: #888; font-size: 0.8rem;">æœ€æ–°æœŸæ•¸</div>
                            <div style="color: #ffd700; font-size: 1.5rem; font-weight: bold;" id="displayRound">-</div>
                        </div>
                        <div class="dice-display" id="display1">-</div>
                        <div class="dice-display" id="display2">-</div>
                        <div class="dice-display" id="display3">-</div>
                        <span>=</span>
                        <div class="dice-display" id="displaySum">-</div>
                        <div class="result-type" id="resultType">-</div>
                    </div>

                    <div class="odds-info">
                        <div class="odds-item"><div class="type">å¤§/å°</div><div class="odds">1 è³  2</div></div>
                        <div class="odds-item"><div class="type">è±¹å­</div><div class="odds">1 è³  30</div></div>
                        <div class="odds-item"><div class="type">æŒ‡å®šè±¹å­</div><div class="odds">1 è³  150</div></div>
                    </div>

                    <div class="import-export">
                        <button class="btn btn-secondary" onclick="exportData()">ğŸ“¤ åŒ¯å‡ºè³‡æ–™</button>
                        <button class="btn btn-secondary" onclick="toggleImport()">ğŸ“¥ åŒ¯å…¥è³‡æ–™</button>
                    </div>

                    <div class="import-area" id="importArea">
                        <textarea id="importText" placeholder="æ ¼å¼ï¼šæ¯è¡Œä¸€ç­†ï¼ŒæœŸæ•¸ éª°1 éª°2 éª°3ï¼ˆç©ºæ ¼åˆ†éš”ï¼‰&#10;ä¾‹å¦‚ï¼š&#10;001 4 5 6&#10;002 2 2 2&#10;003 1 3 5"></textarea>
                        <div class="hint">æ”¯æ´æ ¼å¼ï¼šã€ŒæœŸæ•¸ éª°1 éª°2 éª°3ã€ï¼Œæ¯è¡Œä¸€ç­†ï¼Œç©ºæ ¼æˆ–é€—è™Ÿåˆ†éš”</div>
                        <button class="btn btn-primary" style="margin-top: 10px;" onclick="importData()">ç¢ºèªåŒ¯å…¥</button>
                    </div>
                </div>

                <div class="card" style="margin-top: 20px;">
                    <h2>ğŸ›¤ï¸ è·¯å–® (å¤§å°èµ°å‹¢)</h2>
                    <div class="roadmap" id="roadmap"></div>
                </div>

                <div class="card" style="margin-top: 20px;">
                    <h2>ğŸ“œ æ­·å²è¨˜éŒ„ (æœ€å¤š100ç­†)</h2>
                    <div class="history-container">
                        <table class="history-table">
                            <thead>
                                <tr>
                                    <th>æœŸæ•¸</th>
                                    <th>éª°1</th>
                                    <th>éª°2</th>
                                    <th>éª°3</th>
                                    <th>ç¸½å’Œ</th>
                                    <th>çµæœ</th>
                                    <th>æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody id="historyBody"></tbody>
                        </table>
                    </div>
                    <p style="text-align: center; color: #888; margin-top: 10px;" id="recordCount">ç›®å‰ 0 ç­†è¨˜éŒ„</p>
                </div>
            </div>

            <!-- å³å´ï¼šçµ±è¨ˆèˆ‡ç­–ç•¥ -->
            <div>
                <div class="card">
                    <h2>ğŸ“Š çµ±è¨ˆåˆ†æ <span id="analysisRange" style="font-size: 0.8rem; color: #888; font-weight: normal;"></span></h2>
                    
                    <div class="window-select">
                        <label style="color: #888;">åˆ†æè¦–çª—ï¼š</label>
                        <select id="analysisWindow" onchange="updateDisplay()">
                            <option value="10">è¿‘ 10 æœŸ</option>
                            <option value="20">è¿‘ 20 æœŸ</option>
                            <option value="30">è¿‘ 30 æœŸ</option>
                            <option value="0">å…¨éƒ¨</option>
                        </select>
                    </div>

                    <div class="stats-grid">
                        <div class="stat-card">
                            <h3>å¤§</h3>
                            <div class="value" style="color: #e74c3c;" id="bigCount">0</div>
                            <div class="percentage" id="bigPercent">0%</div>
                            <div class="percentage" id="bigCountAll" style="font-size: 0.8rem; margin-top: 5px;">å…¨0æœŸ: 0</div>
                        </div>
                        <div class="stat-card">
                            <h3>å°</h3>
                            <div class="value" style="color: #3498db;" id="smallCount">0</div>
                            <div class="percentage" id="smallPercent">0%</div>
                            <div class="percentage" id="smallCountAll" style="font-size: 0.8rem; margin-top: 5px;">å…¨0æœŸ: 0</div>
                        </div>
                        <div class="stat-card">
                            <h3>è±¹å­</h3>
                            <div class="value" style="color: #ffd700;" id="tripleCount">0</div>
                            <div class="percentage" id="triplePercent">0%</div>
                            <div class="percentage" id="tripleCountAll" style="font-size: 0.8rem; margin-top: 5px;">å…¨0æœŸ: 0</div>
                        </div>
                    </div>

                    <div class="trend-section">
                        <div class="trend-title">ğŸ”¢ å„é»æ•¸å‡ºç¾æ¬¡æ•¸ (å†·/æº«/ç†±)</div>
                        <div class="trend-grid" id="numberTrend"></div>
                    </div>

                    <div class="trend-section">
                        <div class="trend-title">ğŸ¯ ç¸½å’Œåˆ†å¸ƒï¼ˆæ’é™¤è±¹å­ï¼Œåƒ…çµ±è¨ˆ 4-17ï¼‰</div>
                        <div style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px;" id="sumTrend"></div>
                    </div>

                    <div class="trend-section">
                        <div class="trend-title">ğŸ¯ è·¯å‹åˆ†æï¼ˆæ ¸å¿ƒç­–ç•¥ä¾æ“šï¼‰</div>
                        <div class="stats-grid">
                            <div class="stat-card" style="flex: 2;">
                                <h3>ç•¶å‰è·¯å‹</h3>
                                <div class="value" id="patternType" style="font-size: 1.3rem;">-</div>
                                <div class="percentage" id="patternDesc">ç­‰å¾…æ›´å¤šæ•¸æ“š</div>
                            </div>
                            <div class="stat-card">
                                <h3>è·¯å‹ä¿¡å¿ƒ</h3>
                                <div class="value" id="patternConfidence" style="color: #ffd700;">-</div>
                            </div>
                            <div class="stat-card">
                                <h3>é æ¸¬ä¸‹æœŸ</h3>
                                <div class="value" id="patternPredict">-</div>
                            </div>
                        </div>
                        <div class="pattern-legend" style="margin-top: 10px; padding: 10px; background: rgba(0,0,0,0.2); border-radius: 8px; font-size: 0.85rem; color: #888;">
                            <span style="color: #9b59b6;">ğŸ”€ å–®è·³</span>ï¼šå¤§å°å¤§å°äº¤æ›¿ ï½œ
                            <span style="color: #3498db;">ğŸ”„ é›™è·³</span>ï¼šå¤§å¤§å°å°æˆå° ï½œ
                            <span style="color: #2ecc71;">ğŸ‰ é•·é¾</span>ï¼šé€£çºŒåŒå‘ ï½œ
                            <span style="color: #888;">ğŸ“Š äº‚è·¯</span>ï¼šç„¡è¦å¾‹
                        </div>
                    </div>

                    <div class="trend-section">
                        <div class="trend-title">ğŸ‰ é¾å‹¢åˆ†æï¼ˆå¤§/å°ï¼Œè±¹å­è¦–ç‚ºä¸­æ–·ï¼‰</div>
                        <div class="stats-grid">
                            <div class="stat-card">
                                <h3>ç•¶å‰é¾æ³</h3>
                                <div class="value" id="currentStreak">-</div>
                                <div class="percentage" id="streakType">-</div>
                                <div class="percentage" id="dragonStatus" style="margin-top: 5px; font-weight: bold;">-</div>
                            </div>
                            <div class="stat-card">
                                <h3>æœ€é•·å¤§é¾</h3>
                                <div class="value" style="color: #e74c3c;" id="maxBigStreak">0</div>
                            </div>
                            <div class="stat-card">
                                <h3>æœ€é•·å°é¾</h3>
                                <div class="value" style="color: #3498db;" id="maxSmallStreak">0</div>
                            </div>
                        </div>
                        <div class="dragon-legend" style="margin-top: 10px; padding: 10px; background: rgba(0,0,0,0.2); border-radius: 8px; font-size: 0.85rem; color: #888;">
                            <span style="color: #2ecc71;">ğŸ‰ é•·é¾</span>ï¼šé€£3æœŸä»¥ä¸Š ï½œ
                            <span style="color: #e74c3c;">âš”ï¸ æ–·é¾</span>ï¼šä¿å®ˆ7æœŸ/æ¿€é€²6æœŸ ï½œ
                            <span style="color: #f39c12;">ğŸ”„ å›é¾</span>ï¼šæ–·é¾å¾Œå¸¸è·³å›
                        </div>
                    </div>
                </div>

                <div class="card" style="margin-top: 20px;">
                    <h2>ğŸ’° æŠ•æ³¨å»ºè­° <span id="nextRoundHint" style="font-size: 0.9rem; color: #ffd700;"></span></h2>
                    <p style="color: #888; margin-bottom: 15px;">1æ³¨ = $5,000 | å–®æœŸæœ€é«˜60æ³¨ ($300,000)</p>
                    
                    <div class="strategy-toggle">
                        <button class="strategy-btn conservative active" onclick="setStrategy('conservative')">
                            ğŸ›¡ï¸ ä¿å®ˆç­–ç•¥
                            <div class="strategy-desc">è·¯å‹å„ªå…ˆãƒ»è¬¹æ…ç¢ºèªãƒ»é«˜é–€æª»å‡ºæ‰‹</div>
                        </button>
                        <button class="strategy-btn aggressive" onclick="setStrategy('aggressive')">
                            âš”ï¸ æ¿€é€²ç­–ç•¥
                            <div class="strategy-desc">å¤šé‡ä¿¡è™Ÿãƒ»ç©æ¥µè¿½æ“Šãƒ»æ­é…è±¹å­</div>
                        </button>
                    </div>

                    <div class="strategy-explain" id="strategyExplain"></div>

                    <div class="bet-suggestion" id="betSuggestion">
                        <p style="text-align: center; color: #888;">è«‹å…ˆè¼¸å…¥è‡³å°‘3ç­†é–‹çè¨˜éŒ„</p>
                    </div>

                    <div class="confidence-meter" onclick="toggleConfidenceDetail()" style="cursor: pointer;">
                        <label>ç­–ç•¥ä¿¡å¿ƒæŒ‡æ•¸ <span style="font-size: 0.8rem; color: #ffd700;">â“˜ é»æ“ŠæŸ¥çœ‹è©³æƒ…</span></label>
                        <div class="meter-bar">
                            <div class="meter-fill meter-low" id="confidenceFill" style="width: 0%"></div>
                        </div>
                        <p style="text-align: right; color: #888; margin-top: 5px;" id="confidenceText">0%</p>
                    </div>

                    <div class="confidence-detail" id="confidenceDetail" style="display: none;">
                        <div class="detail-title">ğŸ“Š ä¿¡å¿ƒæŒ‡æ•¸èˆ‡ç­–ç•¥èªªæ˜</div>
                        <div class="detail-content">
                            <p><strong>åŸºç¤å€¼ï¼š25%</strong>ï¼ˆå¤šç¶­åº¦è¨Šè™Ÿç´¯åŠ ï¼‰</p>
                            <table class="detail-table">
                                <tr><th colspan="2" style="color: #9b59b6; text-align: left;">ğŸ¯ è·¯å‹åˆ†æ</th></tr>
                                <tr><td>å–®è·³è·¯ï¼ˆâ‰¥60%äº¤æ›¿ï¼‰</td><td class="val">+15~30%</td></tr>
                                <tr><td>é›™è·³è·¯ï¼ˆâ‰¥55%æˆå°ï¼‰</td><td class="val">+10~25%</td></tr>
                                <tr><td>é•·é¾è·¯ï¼ˆé€£çºŒåŒå‘ï¼‰</td><td class="val">+10~20%</td></tr>
                                <tr><th colspan="2" style="color: #2ecc71; text-align: left; padding-top: 8px;">ğŸ‰ é¾å‹¢åˆ†æ</th></tr>
                                <tr><td>è·Ÿé¾ï¼ˆ3æœŸèµ·è·Ÿï¼‰</td><td class="val">+8~18%</td></tr>
                                <tr><td>å›é¾æ™‚æ©Ÿ</td><td class="val">+15%</td></tr>
                                <tr><td>æ–·é¾æ™‚æ©Ÿï¼ˆ7æœŸ+ï¼‰</td><td class="val">+12~18%</td></tr>
                                <tr><th colspan="2" style="color: #f39c12; text-align: left; padding-top: 8px;">ğŸ“Š å…¶ä»–ä¿¡è™Ÿ</th></tr>
                                <tr><td>æ¯”ä¾‹åé›¢ï¼ˆ>25%ï¼‰</td><td class="val">+10~15%</td></tr>
                                <tr><td>è¿‘5æœŸæ¥µç«¯</td><td class="val">+8%</td></tr>
                                <tr><td>è¶¨å‹¢å»¶çºŒï¼ˆ2æœŸï¼‰</td><td class="val">+5%</td></tr>
                                <tr><td>å¤šé‡ä¿¡è™Ÿå…±æŒ¯</td><td class="val">+5~10%</td></tr>
                            </table>
                            <div style="margin-top: 12px; padding: 10px; background: rgba(46, 204, 113, 0.1); border-radius: 8px; border-left: 3px solid #2ecc71;">
                                <strong style="color: #2ecc71;">ğŸ›¡ï¸ ä¿å®ˆç­–ç•¥ç‰¹é»</strong>
                                <p style="font-size: 0.85em; margin-top: 5px;">å°æ³¨å¤šå‡ºæ‰‹ï¼ˆ2-5æ³¨ï¼‰ãƒ»6å±¤å„ªå…ˆç´šä¿è­‰æœ‰å»ºè­°ãƒ»è¿½æ±‚ç©©å®šå°è´</p>
                            </div>
                            <p style="margin-top: 10px; color: #888;">ä¿¡å¿ƒä¸Šé™ 85%ï¼ˆéª°å­ç‚ºéš¨æ©ŸéŠæˆ²ï¼‰</p>
                            <div class="confidence-levels">
                                <span class="level low">< 40% è©¦æ¢</span>
                                <span class="level medium">40-65% æ­£å¸¸</span>
                                <span class="level high">> 65% åŠ ç¢¼</span>
                            </div>
                        </div>
                    </div>

                    <div class="warning-text">
                        âš ï¸ æŠ•æ³¨å»ºè­°åƒ…ä¾›åƒè€ƒï¼Œéª°å¯¶ç‚ºéš¨æ©ŸéŠæˆ²ï¼Œéå¾€çµæœä¸ä»£è¡¨æœªä¾†ã€‚è«‹ç†æ€§æŠ•æ³¨ï¼Œé‡åŠ›è€Œç‚ºã€‚
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ============================================================
        // å¸¸é‡èˆ‡è¨­å®š
        // ============================================================
        const MAX_RECORDS = 100;
        const BET_UNIT = 5000;
        const MAX_BETS = 60;
        const SCHEMA_VERSION = 2; // è³‡æ–™çµæ§‹ç‰ˆæœ¬

        // ç‹€æ…‹
        let records = [];
        let currentStrategy = 'conservative';

        // ============================================================
        // Helper å‡½æ•¸ï¼ˆA1ï¼šæ˜ç¢ºæ‹†åˆ†å¤§å°/è±¹å­åˆ†æï¼‰
        // ============================================================
        
        // åˆ¤æ–·æ˜¯å¦ç‚ºå¤§å°ï¼ˆéè±¹å­ï¼‰
        function isBigSmall(record) {
            return record.type === 'big' || record.type === 'small';
        }

        // å–å¾—å¤§å°é¡å‹ï¼ˆè±¹å­å›å‚³ nullï¼‰
        function getBigSmallType(record) {
            if (record.type === 'big') return 'big';
            if (record.type === 'small') return 'small';
            return null;
        }

        // æ ¹æ“šéª°å­è¨ˆç®—çµæœï¼ˆç´”å‡½æ•¸ï¼‰
        // è¦å‰‡ï¼š10é»æˆ–ä»¥ä¸‹ç‚ºå°ï¼Œ11é»æˆ–ä»¥ä¸Šç‚ºå¤§ï¼Œè±¹å­é€šæ®º
        function getResultType(d1, d2, d3) {
            const sum = d1 + d2 + d3;
            if (d1 === d2 && d2 === d3) {
                return { type: 'triple', sum, tripleNumber: d1 };
            }
            return { type: sum >= 11 ? 'big' : 'small', sum };
        }

        // å¾åŸå§‹è³‡æ–™é‡æ–°è¨ˆç®— type/sumï¼ˆD8ï¼šé¿å…èˆŠè³‡æ–™å•é¡Œï¼‰
        function recalculateRecord(raw) {
            const [d1, d2, d3] = raw.dice;
            const result = getResultType(d1, d2, d3);
            return { ...raw, ...result };
        }

        // æœŸæ•¸ç™½åå–®éæ¿¾ï¼ˆE9ï¼‰
        function sanitizeRound(round) {
            return round.replace(/[^a-zA-Z0-9\-_]/g, '');
        }

        // HTML è½‰ç¾©
        function escapeHtml(str) {
            const div = document.createElement('div');
            div.textContent = str;
            return div.innerHTML;
        }

        // ============================================================
        // é€£çºŒè¶¨å‹¢è¨ˆç®—ï¼ˆB3-B4ï¼šå–®ä¸€å‡½å¼ï¼Œæ¸…æ™°é‚è¼¯ï¼‰
        // ============================================================
        
        // è¨ˆç®—ç•¶å‰é€£çºŒï¼ˆå¾æœ€æ–°é–‹å§‹ï¼Œè±¹å­è¦–ç‚ºä¸­æ–·ï¼‰
        function calcCurrentStreak(records) {
            if (records.length === 0) return { count: 0, type: null };
            
            const first = records[0];
            if (!isBigSmall(first)) {
                return { count: 0, type: 'triple' }; // æœ€æ–°æ˜¯è±¹å­
            }
            
            let count = 1;
            const targetType = getBigSmallType(first);
            
            for (let i = 1; i < records.length; i++) {
                const r = records[i];
                if (!isBigSmall(r)) break; // è±¹å­ä¸­æ–·
                if (getBigSmallType(r) !== targetType) break;
                count++;
            }
            
            return { count, type: targetType };
        }

        // è¨ˆç®—æœ€é•·é€£çºŒï¼ˆå¤§/å°å„è‡ªï¼‰
        function calcMaxStreaks(records) {
            let maxBig = 0, maxSmall = 0;
            let currentBig = 0, currentSmall = 0;
            
            for (const r of records) {
                if (r.type === 'big') {
                    currentBig++;
                    currentSmall = 0;
                    maxBig = Math.max(maxBig, currentBig);
                } else if (r.type === 'small') {
                    currentSmall++;
                    currentBig = 0;
                    maxSmall = Math.max(maxSmall, currentSmall);
                } else {
                    // è±¹å­ï¼šéƒ½æ­¸é›¶
                    currentBig = 0;
                    currentSmall = 0;
                }
            }
            
            return { maxBig, maxSmall };
        }

        // è¨ˆç®—è±¹å­é–“éš”ï¼ˆè·é›¢ä¸Šæ¬¡è±¹å­å¤šå°‘æœŸï¼‰
        function calcTripleGap(records) {
            for (let i = 0; i < records.length; i++) {
                if (records[i].type === 'triple') return i;
            }
            return records.length;
        }

        // ============================================================
        // é¾å‹¢åˆ†æï¼ˆé•·é¾ã€æ–·é¾ã€å›é¾ï¼‰
        // ============================================================
        
        /**
         * åˆ†æé¾çš„ç‹€æ…‹
         * - é•·é¾ï¼šé€£çºŒ3æœŸä»¥ä¸ŠåŒçµæœï¼ˆè·Ÿé¾ï¼‰
         * - æ–·é¾ï¼šä¿å®ˆ7æœŸä»¥ä¸Šã€æ¿€é€²6æœŸä»¥ä¸Šï¼Œå¯è€ƒæ…®åæŠ¼
         * - å›é¾ï¼šä¸Šä¸€æ¢é¾å‰›æ–·ï¼ˆ6æœŸä»¥ä¸Šï¼‰ï¼Œç•¶å‰é€£çºŒ1-2æœŸï¼Œå¯æŠ¼å›åŸé¾æ–¹å‘
         */
        function analyzeDragon(records, breakThreshold = 6) {
            if (records.length < 2) {
                return { status: 'none', currentStreak: null, prevDragon: null };
            }
            
            const currentStreak = calcCurrentStreak(records);
            
            // æ‰¾ä¸Šä¸€æ¢é¾ï¼ˆç•¶å‰é€£çºŒä¹‹å¾Œçš„é‚£æ¢ï¼‰
            let prevDragonType = null;
            let prevDragonLength = 0;
            
            if (currentStreak.count > 0 && records.length > currentStreak.count) {
                // å¾ç•¶å‰é€£çºŒçµæŸä½ç½®é–‹å§‹æ‰¾ä¸Šä¸€æ¢
                let startIdx = currentStreak.count;
                
                // è·³éå¯èƒ½çš„è±¹å­
                while (startIdx < records.length && records[startIdx].type === 'triple') {
                    startIdx++;
                }
                
                if (startIdx < records.length) {
                    prevDragonType = getBigSmallType(records[startIdx]);
                    if (prevDragonType) {
                        prevDragonLength = 1;
                        for (let i = startIdx + 1; i < records.length; i++) {
                            if (records[i].type === 'triple') break;
                            if (getBigSmallType(records[i]) !== prevDragonType) break;
                            prevDragonLength++;
                        }
                    }
                }
            }
            
            const prevDragon = prevDragonType ? { type: prevDragonType, length: prevDragonLength } : null;
            
            // åˆ¤æ–·é¾çš„ç‹€æ…‹
            let status = 'none';
            let strategyHint = null;
            
            if (currentStreak.type && currentStreak.type !== 'triple') {
                if (currentStreak.count >= breakThreshold) {
                    // é”åˆ°æ–·é¾é–€æª»ï¼šæ–·é¾æ™‚æ©Ÿ
                    status = 'breakable';
                    strategyHint = {
                        action: 'break',
                        target: currentStreak.type === 'big' ? 'small' : 'big',
                        reason: `${currentStreak.type === 'big' ? 'å¤§' : 'å°'}é¾å·²${currentStreak.count}æœŸï¼Œå¯è€ƒæ…®æ–·é¾`
                    };
                } else if (currentStreak.count >= 3) {
                    // é•·é¾3-5æœŸï¼šè·Ÿé¾
                    status = 'riding';
                    strategyHint = {
                        action: 'ride',
                        target: currentStreak.type,
                        reason: `${currentStreak.type === 'big' ? 'å¤§' : 'å°'}é¾é€²è¡Œä¸­ï¼ˆ${currentStreak.count}æœŸï¼‰ï¼Œå¯è·Ÿé¾`
                    };
                } else if (currentStreak.count <= 2 && prevDragon && prevDragon.length >= 6) {
                    // ä¸Šä¸€æ¢æ˜¯é•·é¾ï¼ˆ6æœŸä»¥ä¸Šï¼‰å‰›æ–·ï¼Œç•¶å‰1-2æœŸï¼šå›é¾æ™‚æ©Ÿ
                    status = 'returning';
                    strategyHint = {
                        action: 'return',
                        target: prevDragon.type,
                        reason: `${prevDragon.type === 'big' ? 'å¤§' : 'å°'}é¾ï¼ˆ${prevDragon.length}æœŸï¼‰å‰›æ–·ï¼Œå¯æŠ¼å›é¾`
                    };
                } else {
                    // çŸ­é€£çºŒï¼Œè§€æœ›
                    status = 'building';
                }
            } else if (currentStreak.type === 'triple') {
                // è±¹å­ä¸­æ–·
                if (prevDragon && prevDragon.length >= 6) {
                    status = 'returning';
                    strategyHint = {
                        action: 'return',
                        target: prevDragon.type,
                        reason: `${prevDragon.type === 'big' ? 'å¤§' : 'å°'}é¾ï¼ˆ${prevDragon.length}æœŸï¼‰è¢«è±¹å­ä¸­æ–·ï¼Œå¯æŠ¼å›é¾`
                    };
                }
            }
            
            return {
                status,
                currentStreak,
                prevDragon,
                strategyHint
            };
        }
        
        // å–å¾—é¾ç‹€æ…‹çš„é¡¯ç¤ºæ–‡å­—
        function getDragonStatusText(dragon) {
            switch (dragon.status) {
                case 'riding':
                    return `ğŸ‰ é•·é¾ä¸­`;
                case 'breakable':
                    return `âš”ï¸ å¯æ–·é¾`;
                case 'returning':
                    return `ğŸ”„ å›é¾æ™‚æ©Ÿ`;
                case 'building':
                    return `ğŸ“Š è§€æœ›ä¸­`;
                default:
                    return '-';
            }
        }
        
        // å–å¾—é¾ç‹€æ…‹çš„é¡è‰²
        function getDragonStatusColor(dragon) {
            switch (dragon.status) {
                case 'riding': return '#2ecc71';
                case 'breakable': return '#e74c3c';
                case 'returning': return '#f39c12';
                default: return '#888';
            }
        }

        // ============================================================
        // çµ±è¨ˆè¨ˆç®—æ ¸å¿ƒï¼ˆG13ï¼šåˆ†é›¢è¨ˆç®—èˆ‡æ¸²æŸ“ï¼‰
        // ============================================================
        
        function computeMetrics(records, windowSize) {
            const window = windowSize > 0 ? records.slice(0, windowSize) : records;
            const total = window.length;
            
            // å¤§å°è±¹å­çµ±è¨ˆï¼ˆåªçœ‹ window ç¯„åœï¼‰
            const bigCount = window.filter(r => r.type === 'big').length;
            const smallCount = window.filter(r => r.type === 'small').length;
            const tripleCount = window.filter(r => r.type === 'triple').length;
            
            // å¤§å°æ¯”ä¾‹ï¼ˆæ’é™¤è±¹å­ï¼‰
            const bigSmallTotal = bigCount + smallCount;
            const bigRatio = bigSmallTotal > 0 ? bigCount / bigSmallTotal : 0.5;
            const deviation = Math.abs(bigRatio - 0.5);
            
            // é€£çºŒè¶¨å‹¢
            const currentStreak = calcCurrentStreak(records); // ç”¨å…¨éƒ¨è³‡æ–™
            const maxStreaks = calcMaxStreaks(records);
            const tripleGap = calcTripleGap(records);
            
            // å„é»æ•¸çµ±è¨ˆ
            const numberCounts = [0, 0, 0, 0, 0, 0];
            window.forEach(r => r.dice.forEach(d => numberCounts[d - 1]++));
            const totalDice = total * 3;
            const avgNumber = totalDice / 6;
            
            // å†·ç†±è™Ÿï¼ˆé–€æª»æ”¹ç‚ºæ›´ç›´è¦ºï¼š>=7 ç†±ã€<=3 å†·ï¼ŒåŸºæ–¼è¿‘ N æœŸ 30 é¡†éª°å­ï¼‰
            const coldNumbers = [];
            const hotNumbers = [];
            if (total >= 5) {
                numberCounts.forEach((count, i) => {
                    const threshold = totalDice / 6;
                    if (count >= threshold * 1.4) hotNumbers.push(i + 1);  // æ¯”å¹³å‡å¤š40%
                    if (count <= threshold * 0.6) coldNumbers.push(i + 1); // æ¯”å¹³å‡å°‘40%
                });
            }
            
            // ç¸½å’Œåˆ†å¸ƒï¼ˆæ’é™¤è±¹å­ï¼‰
            const sumCounts = {};
            for (let i = 4; i <= 17; i++) sumCounts[i] = 0;
            window.forEach(r => {
                if (isBigSmall(r) && sumCounts[r.sum] !== undefined) {
                    sumCounts[r.sum]++;
                }
            });
            
            // è¿‘5æœŸçµ±è¨ˆ
            const recent5 = records.slice(0, 5);
            const recentBig = recent5.filter(r => r.type === 'big').length;
            const recentSmall = recent5.filter(r => r.type === 'small').length;
            
            // å…¨éƒ¨è¨˜éŒ„çµ±è¨ˆ
            const allBig = records.filter(r => r.type === 'big').length;
            const allSmall = records.filter(r => r.type === 'small').length;
            const allTriple = records.filter(r => r.type === 'triple').length;
            
            // é¾å‹¢åˆ†æ
            const dragon = analyzeDragon(records);
            
            return {
                window,
                total,
                bigCount,
                smallCount,
                tripleCount,
                bigRatio,
                deviation,
                currentStreak,
                maxStreaks,
                tripleGap,
                numberCounts,
                coldNumbers,
                hotNumbers,
                sumCounts,
                recentBig,
                recentSmall,
                allBig,
                allSmall,
                allTriple,
                allTotal: records.length,
                dragon
            };
        }

        // ============================================================
        // è·¯å‹åˆ†æï¼ˆå–®è·³ã€é›™è·³ã€é•·é¾ï¼‰
        // ============================================================
        
        /**
         * åˆ†æè·¯å‹æ¨¡å¼
         * - å–®è·³ï¼šå¤§å°å¤§å°å¤§å°ï¼ˆäº¤æ›¿å‡ºç¾ï¼‰
         * - é›™è·³ï¼šå¤§å¤§å°å°å¤§å¤§ï¼ˆæˆå°äº¤æ›¿ï¼‰
         * - é•·é¾ï¼šé€£çºŒåŒçµæœ
         * - äº‚è·¯ï¼šç„¡è¦å¾‹
         */
        function analyzePattern(records) {
            if (records.length < 4) return { type: 'insufficient', confidence: 0 };
            
            // åªå–å¤§å°çµæœï¼ˆæ’é™¤è±¹å­ï¼‰
            const results = [];
            for (let i = 0; i < Math.min(records.length, 20); i++) {
                if (isBigSmall(records[i])) {
                    results.push(records[i].type);
                }
            }
            
            if (results.length < 4) return { type: 'insufficient', confidence: 0 };
            
            // æª¢æ¸¬å–®è·³ï¼šABAB...
            let singleJumpCount = 0;
            for (let i = 0; i < results.length - 1; i++) {
                if (results[i] !== results[i + 1]) singleJumpCount++;
            }
            const singleJumpRatio = singleJumpCount / (results.length - 1);
            
            // æª¢æ¸¬é›™è·³ï¼šAABB...
            let doubleJumpCount = 0;
            for (let i = 0; i < results.length - 2; i += 2) {
                if (results[i] === results[i + 1] && 
                    (i + 2 >= results.length || results[i + 1] !== results[i + 2])) {
                    doubleJumpCount++;
                }
            }
            const doubleJumpRatio = doubleJumpCount / Math.floor(results.length / 2);
            
            // åˆ¤æ–·è·¯å‹
            if (singleJumpRatio >= 0.75) {
                return { 
                    type: 'singleJump', 
                    confidence: Math.min(singleJumpRatio * 100, 85),
                    nextPredict: results[0] === 'big' ? 'small' : 'big',
                    description: 'å–®è·³è·¯ï¼ˆå¤§å°äº¤æ›¿ï¼‰'
                };
            }
            
            if (doubleJumpRatio >= 0.6 && results.length >= 6) {
                // åˆ¤æ–·é›™è·³çš„ä¸‹ä¸€æœŸ
                const lastPair = results.slice(0, 2);
                const isCompletePair = lastPair[0] === lastPair[1];
                return {
                    type: 'doubleJump',
                    confidence: Math.min(doubleJumpRatio * 90, 75),
                    nextPredict: isCompletePair ? (lastPair[0] === 'big' ? 'small' : 'big') : lastPair[0],
                    description: 'é›™è·³è·¯ï¼ˆæˆå°äº¤æ›¿ï¼‰'
                };
            }
            
            // æª¢æŸ¥æ˜¯å¦ç‚ºé•·é¾
            const currentStreak = calcCurrentStreak(records);
            if (currentStreak.count >= 3 && currentStreak.type !== 'triple') {
                return {
                    type: 'dragon',
                    confidence: Math.min(40 + currentStreak.count * 8, 80),
                    currentType: currentStreak.type,
                    length: currentStreak.count,
                    description: `${currentStreak.type === 'big' ? 'å¤§' : 'å°'}é¾ï¼ˆ${currentStreak.count}æœŸï¼‰`
                };
            }
            
            return { type: 'random', confidence: 30, description: 'äº‚è·¯ï¼ˆç„¡æ˜é¡¯è¦å¾‹ï¼‰' };
        }
        
        /**
         * è¨ˆç®—ç¸½å’Œå€é–“ç†±åº¦
         * æ ¹æ“šæ–°è¦å‰‡ï¼š3-10å°ï¼Œ11-18å¤§
         * é—œæ³¨è‡¨ç•Œå€é–“ 9-12 çš„å‡ºç¾é »ç‡
         */
        function analyzeSumZones(records) {
            if (records.length < 10) return null;
            
            const window = records.slice(0, 20).filter(r => isBigSmall(r));
            if (window.length < 8) return null;
            
            // å€é–“å®šç¾©
            const zones = {
                lowSmall: { range: '4-7', count: 0 },     // ç©©å°å€
                midSmall: { range: '8-10', count: 0 },    // è‡¨ç•Œå°å€
                midBig: { range: '11-13', count: 0 },     // è‡¨ç•Œå¤§å€
                highBig: { range: '14-17', count: 0 }     // ç©©å¤§å€
            };
            
            window.forEach(r => {
                if (r.sum >= 4 && r.sum <= 7) zones.lowSmall.count++;
                else if (r.sum >= 8 && r.sum <= 10) zones.midSmall.count++;
                else if (r.sum >= 11 && r.sum <= 13) zones.midBig.count++;
                else if (r.sum >= 14 && r.sum <= 17) zones.highBig.count++;
            });
            
            const total = window.length;
            const midRatio = (zones.midSmall.count + zones.midBig.count) / total;
            const extremeRatio = (zones.lowSmall.count + zones.highBig.count) / total;
            
            return {
                zones,
                total,
                midRatio,      // è‡¨ç•Œå€æ¯”ä¾‹
                extremeRatio,  // æ¥µç«¯å€æ¯”ä¾‹
                hotZone: Object.entries(zones).reduce((a, b) => b[1].count > a[1].count ? b : a)[0]
            };
        }

        // ============================================================
        // è¨Šè™Ÿæ——æ¨™ç³»çµ±ï¼ˆå„ªåŒ–ç‰ˆï¼šåŠ å…¥è·¯å‹ã€å€é–“åˆ†æï¼‰
        // ============================================================
        
        function computeSignals(metrics) {
            const pattern = analyzePattern(records);
            const sumZones = analyzeSumZones(records);
            
            const signals = {
                // é€£çºŒè¶¨å‹¢ç­‰ç´š
                streakLevel: 0,
                streakType: null,
                // é¾å‹¢ç‹€æ…‹
                dragon: metrics.dragon,
                // è·¯å‹åˆ†æ
                pattern,
                // ç¸½å’Œå€é–“
                sumZones,
                // æ¯”ä¾‹åé›¢ç­‰ç´š
                deviationLevel: 0,
                // è¿‘5æœŸæ¥µç«¯
                extreme5: null,
                // è±¹å­é–“éš”ç­‰ç´š
                tripleGapLevel: 0,
                // åŸå§‹æ•¸æ“š
                raw: metrics
            };
            
            // é€£çºŒè¶¨å‹¢ï¼ˆå„ªåŒ–ï¼šæ›´è¬¹æ…çš„åˆ¤å®šï¼‰
            if (metrics.currentStreak.type && metrics.currentStreak.type !== 'triple') {
                const streak = metrics.currentStreak.count;
                if (streak >= 7) signals.streakLevel = 4;      // è¶…é•·é¾ï¼ˆé«˜é¢¨éšªå€ï¼‰
                else if (streak >= 5) signals.streakLevel = 3; // é•·é¾å¯æ–·
                else if (streak >= 4) signals.streakLevel = 2; // é¾å‹¢ç¢ºèª
                else if (streak >= 3) signals.streakLevel = 1; // é¾æˆå½¢ï¼ˆè§€å¯Ÿï¼‰
                signals.streakType = metrics.currentStreak.type;
            }
            
            // æ¯”ä¾‹åé›¢ï¼ˆå„ªåŒ–é–€æª»ï¼‰
            if (metrics.total >= 5) {
                if (metrics.deviation > 0.35) signals.deviationLevel = 3;      // åš´é‡å¤±è¡¡
                else if (metrics.deviation > 0.25) signals.deviationLevel = 2; // æ˜é¡¯åé›¢
                else if (metrics.deviation > 0.15) signals.deviationLevel = 1; // è¼•å¾®åé›¢
            }
            
            // è¿‘5æœŸæ¥µç«¯ï¼ˆå„ªåŒ–ï¼šè€ƒæ…®è·¯å‹ï¼‰
            if (metrics.recentBig >= 4) signals.extreme5 = 'big';
            else if (metrics.recentSmall >= 4) signals.extreme5 = 'small';
            
            // è±¹å­é–“éš”ï¼ˆå„ªåŒ–ï¼šæ›´ä¿å®ˆï¼‰
            if (metrics.tripleGap >= 25) signals.tripleGapLevel = 2;
            else if (metrics.tripleGap >= 15) signals.tripleGapLevel = 1;
            
            return signals;
        }

        // æ ¹æ“šè¨Šè™Ÿè¨ˆç®—ä¿¡å¿ƒæŒ‡æ•¸ï¼ˆå„ªåŒ–ç‰ˆï¼‰
        function computeConfidence(signals) {
            let confidence = 25; // åŸºç¤å€¼é™ä½ï¼Œæ›´ä¿å®ˆ
            const reasons = [];
            const metrics = signals.raw;
            const dragon = signals.dragon;
            const pattern = signals.pattern;
            
            // ========== è·¯å‹åˆ†æï¼ˆæœ€é«˜æ¬Šé‡ï¼‰ ==========
            if (pattern && pattern.type !== 'insufficient' && pattern.type !== 'random') {
                if (pattern.type === 'singleJump') {
                    confidence += Math.min(pattern.confidence * 0.35, 30);
                    reasons.push(`ğŸ”€ å–®è·³è·¯å‹ï¼ˆä¿¡å¿ƒ${pattern.confidence.toFixed(0)}%ï¼‰`);
                } else if (pattern.type === 'doubleJump') {
                    confidence += Math.min(pattern.confidence * 0.3, 25);
                    reasons.push(`ğŸ”„ é›™è·³è·¯å‹ï¼ˆä¿¡å¿ƒ${pattern.confidence.toFixed(0)}%ï¼‰`);
                } else if (pattern.type === 'dragon') {
                    confidence += Math.min(pattern.confidence * 0.25, 20);
                    reasons.push(`ğŸ‰ ${pattern.description}`);
                }
            }
            
            // ========== é¾å‹¢åˆ†æ ==========
            if (dragon && dragon.strategyHint) {
                const hint = dragon.strategyHint;
                const streak = metrics.currentStreak.count;
                
                if (dragon.status === 'breakable') {
                    // æ–·é¾ä¿¡å¿ƒè¦æ‰“æŠ˜ï¼ˆé€†å‹¢æ“ä½œï¼‰
                    const breakBonus = streak >= 8 ? 18 : streak >= 7 ? 12 : 8;
                    confidence += breakBonus;
                    reasons.push(`âš”ï¸ ${hint.reason}ï¼ˆé€†å‹¢é¢¨éšªï¼‰`);
                } else if (dragon.status === 'returning') {
                    confidence += 15;
                    reasons.push(`ğŸ”„ ${hint.reason}`);
                } else if (dragon.status === 'riding') {
                    confidence += streak >= 5 ? 18 : streak >= 4 ? 12 : 8;
                    reasons.push(`ğŸ‰ ${hint.reason}`);
                }
            }
            
            // ========== æ¯”ä¾‹åé›¢ ==========
            if (signals.deviationLevel >= 3) {
                confidence += 15;
                reasons.push(`ğŸ“Š åš´é‡å¤±è¡¡ï¼šå¤§${(metrics.bigRatio * 100).toFixed(0)}%`);
            } else if (signals.deviationLevel >= 2) {
                confidence += 10;
                reasons.push(`ğŸ“Š æ¯”ä¾‹åé›¢ï¼šå¤§${(metrics.bigRatio * 100).toFixed(0)}%`);
            } else if (signals.deviationLevel === 1) {
                confidence += 5;
            }
            
            // ========== è¿‘5æœŸæ¥µç«¯ ==========
            if (signals.extreme5) {
                confidence += 8;
                const count = signals.extreme5 === 'big' ? metrics.recentBig : metrics.recentSmall;
                reasons.push(`è¿‘5æœŸ${signals.extreme5 === 'big' ? 'å¤§' : 'å°'}å‡º${count}æ¬¡`);
            }
            
            // ========== å¤šé‡ä¿¡è™ŸåŠ æˆ ==========
            let signalCount = 0;
            if (pattern && pattern.type !== 'random' && pattern.type !== 'insufficient') signalCount++;
            if (dragon && dragon.strategyHint) signalCount++;
            if (signals.deviationLevel >= 2) signalCount++;
            if (signals.extreme5) signalCount++;
            
            if (signalCount >= 3) {
                confidence += 10;
                reasons.push(`ğŸ¯ ${signalCount}é‡ä¿¡è™Ÿå…±æŒ¯`);
            } else if (signalCount >= 2) {
                confidence += 5;
            }
            
            // ========== è±¹å­é–“éš”ï¼ˆå¼±åŒ–ï¼Œé¿å…èª¤å°ï¼‰==========
            if (signals.tripleGapLevel === 2) {
                reasons.push(`ğŸ² ${metrics.tripleGap}æœŸæœªå‡ºè±¹å­ï¼ˆåƒ…ä¾›åƒè€ƒï¼‰`);
            }
            
            // ========== å†·ç†±è™Ÿ ==========
            if (metrics.coldNumbers.length > 0) {
                reasons.push(`â„ï¸ å†·è™Ÿ: ${metrics.coldNumbers.join(', ')}`);
            }
            if (metrics.hotNumbers.length > 0) {
                reasons.push(`ğŸ”¥ ç†±è™Ÿ: ${metrics.hotNumbers.join(', ')}`);
            }
            
            // ========== ä¿¡å¿ƒä¸Šé™ï¼ˆéª°å­æ˜¯éš¨æ©ŸéŠæˆ²ï¼‰==========
            return {
                confidence: Math.min(confidence, 85), // é™ä½ä¸Šé™
                reasons
            };
        }

        // ============================================================
        // æŠ•æ³¨å»ºè­°ç”Ÿæˆï¼ˆå„ªåŒ–ç‰ˆï¼šè·¯å‹å„ªå…ˆ + æ³¨ç¢¼ç®¡ç†ï¼‰
        // ============================================================
        
        function generateSuggestions(signals, strategy) {
            const suggestions = [];
            const metrics = signals.raw;
            const pattern = signals.pattern;
            
            // æ ¹æ“šç­–ç•¥ä½¿ç”¨ä¸åŒçš„æ–·é¾é–€æª»ï¼šä¿å®ˆ7æœŸã€æ¿€é€²6æœŸ
            const breakThreshold = strategy === 'conservative' ? 7 : 6;
            const dragon = analyzeDragon(records, breakThreshold);
            
            // ========== è¨ˆç®—åŸºç¤æ³¨ç¢¼ï¼ˆæ ¹æ“šä¿¡è™Ÿå¼·åº¦ï¼‰ ==========
            const calculateBets = (baseAmount, signalStrength) => {
                // signalStrength: 1-5ï¼Œå½±éŸ¿å¯¦éš›ä¸‹æ³¨é‡
                const multiplier = strategy === 'conservative' ? 0.8 : 1.2;
                return Math.min(Math.round(baseAmount * multiplier * (0.6 + signalStrength * 0.2)), MAX_BETS);
            };
            
            if (strategy === 'conservative') {
                // ========== ä¿å®ˆç­–ç•¥ï¼šç©æ¥µçµ¦å»ºè­°ï¼Œä¿å®ˆçµ¦æ³¨ç¢¼ ==========
                // æ ¸å¿ƒåŸå‰‡ï¼šä¿å®ˆ = å°æ³¨å¤šå‡ºæ‰‹ï¼Œè€Œéä¸å‡ºæ‰‹
                
                const streak = metrics.currentStreak.count;
                const streakType = metrics.currentStreak.type;
                
                // ===== å„ªå…ˆç´š1ï¼šæ˜ç¢ºè·¯å‹ï¼ˆé™ä½é–€æª»ï¼‰=====
                if (pattern && pattern.type === 'singleJump' && pattern.confidence >= 60) {
                    const betSize = pattern.confidence >= 75 ? 5 : pattern.confidence >= 65 ? 4 : 3;
                    suggestions.push({
                        type: `æŠ¼${pattern.nextPredict === 'big' ? 'å¤§' : 'å°'}`,
                        reason: `ğŸ”€ å–®è·³è·¯ï¼ˆ${pattern.confidence.toFixed(0)}%ï¼‰ï¼Œé æ¸¬è·³è½‰`,
                        bets: betSize,
                        odds: 2,
                        priority: 1,
                        riskLevel: pattern.confidence >= 70 ? 'low' : 'medium'
                    });
                } else if (pattern && pattern.type === 'doubleJump' && pattern.confidence >= 55) {
                    const betSize = pattern.confidence >= 70 ? 4 : 3;
                    suggestions.push({
                        type: `æŠ¼${pattern.nextPredict === 'big' ? 'å¤§' : 'å°'}`,
                        reason: `ğŸ”„ é›™è·³è·¯ï¼ˆ${pattern.confidence.toFixed(0)}%ï¼‰`,
                        bets: betSize,
                        odds: 2,
                        priority: 1,
                        riskLevel: 'medium'
                    });
                }
                
                // ===== å„ªå…ˆç´š2ï¼šé¾å‹¢ç­–ç•¥ï¼ˆæ”¾å¯¬æ¢ä»¶ï¼‰=====
                if (suggestions.length === 0 && dragon && dragon.strategyHint) {
                    const hint = dragon.strategyHint;
                    
                    if (dragon.status === 'breakable' && streak >= 7) {
                        // æ–·é¾ï¼š7æœŸä»¥ä¸Š
                        suggestions.push({
                            type: `æŠ¼${hint.target === 'big' ? 'å¤§' : 'å°'}`,
                            reason: `âš”ï¸ æ–·é¾ï¼š${streak}æœŸ${streakType === 'big' ? 'å¤§' : 'å°'}é¾`,
                            bets: streak >= 9 ? 5 : 4,
                            odds: 2,
                            priority: 2,
                            riskLevel: 'high',
                            warning: 'é€†å‹¢æ“ä½œï¼Œå°æ³¨è©¦æ¢'
                        });
                    } else if (dragon.status === 'returning') {
                        // å›é¾
                        suggestions.push({
                            type: `æŠ¼${hint.target === 'big' ? 'å¤§' : 'å°'}`,
                            reason: `ğŸ”„ å›é¾ï¼š${hint.reason}`,
                            bets: 4,
                            odds: 2,
                            priority: 2,
                            riskLevel: 'medium'
                        });
                    } else if (dragon.status === 'riding' && streak >= 3) {
                        // è·Ÿé¾ï¼šé™ä½åˆ°3æœŸï¼ˆä¿å®ˆç”¨å°æ³¨ï¼‰
                        const betSize = streak >= 5 ? 5 : streak >= 4 ? 4 : 3;
                        suggestions.push({
                            type: `æŠ¼${hint.target === 'big' ? 'å¤§' : 'å°'}`,
                            reason: `ğŸ‰ è·Ÿé¾ï¼šé€£${streak}æœŸ${streakType === 'big' ? 'å¤§' : 'å°'}`,
                            bets: betSize,
                            odds: 2,
                            priority: 2,
                            riskLevel: streak >= 4 ? 'low' : 'medium'
                        });
                    }
                }
                
                // ===== å„ªå…ˆç´š3ï¼šæ¯”ä¾‹åé›¢ï¼ˆé™ä½é–€æª»ï¼‰=====
                if (suggestions.length === 0 && signals.deviationLevel >= 2 && metrics.total >= 8) {
                    const targetBet = metrics.bigRatio > 0.5 ? 'small' : 'big';
                    const betSize = signals.deviationLevel >= 3 ? 4 : 3;
                    suggestions.push({
                        type: `æŠ¼${targetBet === 'big' ? 'å¤§' : 'å°'}`,
                        reason: `ğŸ“Š è¿½å›æ­¸ï¼šå¤§${(metrics.bigRatio * 100).toFixed(0)}%`,
                        bets: betSize,
                        odds: 2,
                        priority: 3,
                        riskLevel: 'medium'
                    });
                }
                
                // ===== å„ªå…ˆç´š4ï¼šè¿‘æœŸè¶¨å‹¢å»¶çºŒ =====
                if (suggestions.length === 0 && streak >= 2 && streakType && streakType !== 'triple') {
                    // é€£2æœŸåŒå‘ï¼Œå°æ³¨è·Ÿéš¨
                    suggestions.push({
                        type: `æŠ¼${streakType === 'big' ? 'å¤§' : 'å°'}`,
                        reason: `ğŸ“ˆ è¶¨å‹¢å»¶çºŒï¼šé€£${streak}æœŸ${streakType === 'big' ? 'å¤§' : 'å°'}`,
                        bets: 2,
                        odds: 2,
                        priority: 4,
                        riskLevel: 'medium',
                        betAdvice: 'è¶¨å‹¢å°šçŸ­ï¼Œä¿å®ˆè©¦æ¢'
                    });
                }
                
                // ===== å„ªå…ˆç´š5ï¼šè¿‘5æœŸæ¥µç«¯ =====
                if (suggestions.length === 0 && signals.extreme5) {
                    const targetBet = signals.extreme5 === 'big' ? 'small' : 'big';
                    const count = signals.extreme5 === 'big' ? metrics.recentBig : metrics.recentSmall;
                    suggestions.push({
                        type: `æŠ¼${targetBet === 'big' ? 'å¤§' : 'å°'}`,
                        reason: `ğŸ¯ è¿‘5æœŸ${signals.extreme5 === 'big' ? 'å¤§' : 'å°'}å‡º${count}æ¬¡`,
                        bets: 2,
                        odds: 2,
                        priority: 5,
                        riskLevel: 'medium'
                    });
                }
                
                // ===== å„ªå…ˆç´š6ï¼šå…œåº•ç­–ç•¥ï¼ˆç¸½è¦æœ‰å»ºè­°ï¼‰=====
                if (suggestions.length === 0 && records.length >= 3) {
                    // åˆ†ææœ€è¿‘3æœŸçš„è¶¨å‹¢å‚¾å‘
                    const recent3 = records.slice(0, 3).filter(r => isBigSmall(r));
                    const recent3Big = recent3.filter(r => r.type === 'big').length;
                    const recent3Small = recent3.filter(r => r.type === 'small').length;
                    
                    let targetBet, reason;
                    
                    if (recent3Big > recent3Small) {
                        // è¿‘æœŸåå¤§ï¼Œè€ƒæ…®è·Ÿæˆ–å
                        if (records[0].type === 'big') {
                            targetBet = 'big';
                            reason = 'è¿‘æœŸåå¤§ï¼Œé †å‹¢å°æŠ¼';
                        } else {
                            targetBet = 'small';
                            reason = 'è¿‘æœŸåå¤§ä½†å‰›å‡ºå°ï¼Œè§€å¯Ÿè·³è½‰';
                        }
                    } else if (recent3Small > recent3Big) {
                        if (records[0].type === 'small') {
                            targetBet = 'small';
                            reason = 'è¿‘æœŸåå°ï¼Œé †å‹¢å°æŠ¼';
                        } else {
                            targetBet = 'big';
                            reason = 'è¿‘æœŸåå°ä½†å‰›å‡ºå¤§ï¼Œè§€å¯Ÿè·³è½‰';
                        }
                    } else {
                        // å‡å‹¢ï¼šè·Ÿæœ€æ–°ä¸€æœŸ
                        targetBet = records[0].type === 'big' ? 'big' : 
                                   records[0].type === 'small' ? 'small' : 
                                   (Math.random() > 0.5 ? 'big' : 'small');
                        reason = 'è¿‘æœŸå‡å‹¢ï¼Œè·Ÿéš¨æœ€æ–°';
                    }
                    
                    if (targetBet) {
                        suggestions.push({
                            type: `æŠ¼${targetBet === 'big' ? 'å¤§' : 'å°'}`,
                            reason: `ğŸ’¡ ${reason}`,
                            bets: 2,
                            odds: 2,
                            priority: 6,
                            riskLevel: 'low',
                            betAdvice: 'ä¿¡è™Ÿè¼ƒå¼±ï¼Œæœ€å°æ³¨è©¦æ¢'
                        });
                    }
                }
                
            } else {
                // ========== æ¿€é€²ç­–ç•¥ï¼šå¤šé‡ä¿¡è™Ÿ + è¿½æ“Š ==========
                
                // å„ªå…ˆç´š1ï¼šæ˜ç¢ºè·¯å‹
                if (pattern && (pattern.type === 'singleJump' || pattern.type === 'doubleJump') && pattern.confidence >= 60) {
                    suggestions.push({
                        type: `æŠ¼${pattern.nextPredict === 'big' ? 'å¤§' : 'å°'}`,
                        reason: `ğŸ¯ ${pattern.description}ï¼ˆä¿¡å¿ƒ${pattern.confidence.toFixed(0)}%ï¼‰`,
                        bets: calculateBets(8, pattern.confidence / 20),
                        odds: 2,
                        priority: 1,
                        riskLevel: 'medium'
                    });
                }
                
                // å„ªå…ˆç´š2ï¼šé¾å‹¢ç­–ç•¥
                if (dragon && dragon.strategyHint) {
                    const hint = dragon.strategyHint;
                    const streak = metrics.currentStreak.count;
                    
                    // æª¢æŸ¥æ˜¯å¦èˆ‡è·¯å‹è¡çª
                    const patternConflict = suggestions.length > 0 && 
                        suggestions[0].type.includes(hint.target === 'big' ? 'å°' : 'å¤§');
                    
                    if (dragon.status === 'breakable' && streak >= 6 && !patternConflict) {
                        suggestions.push({
                            type: `æŠ¼${hint.target === 'big' ? 'å¤§' : 'å°'}`,
                            reason: `âš”ï¸ æ–·é¾ï¼š${hint.reason}`,
                            bets: calculateBets(streak >= 8 ? 15 : 10, 4),
                            odds: 2,
                            priority: patternConflict ? 3 : 2,
                            riskLevel: 'high',
                            warning: 'æ–·é¾é¢¨éšªè¼ƒé«˜ï¼Œå»ºè­°æ­é…æ­¢æ'
                        });
                    } else if (dragon.status === 'returning' && !patternConflict) {
                        suggestions.push({
                            type: `æŠ¼${hint.target === 'big' ? 'å¤§' : 'å°'}`,
                            reason: `ğŸ”„ å›é¾ï¼š${hint.reason}`,
                            bets: calculateBets(8, 3),
                            odds: 2,
                            priority: 2,
                            riskLevel: 'medium'
                        });
                    } else if (dragon.status === 'riding' && streak >= 3) {
                        // æ¿€é€²ç­–ç•¥3æœŸå°±è·Ÿé¾
                        const existingSameBet = suggestions.find(s => 
                            s.type === `æŠ¼${hint.target === 'big' ? 'å¤§' : 'å°'}`);
                        if (existingSameBet) {
                            // åŒæ–¹å‘ï¼šåŠ æ³¨
                            existingSameBet.bets = Math.min(existingSameBet.bets + 4, MAX_BETS);
                            existingSameBet.reason += ' + é †é¾å‹¢';
                        } else if (!patternConflict) {
                            suggestions.push({
                                type: `æŠ¼${hint.target === 'big' ? 'å¤§' : 'å°'}`,
                                reason: `ğŸ‰ è·Ÿé¾ï¼š${hint.reason}`,
                                bets: calculateBets(streak >= 5 ? 10 : 6, 3),
                                odds: 2,
                                priority: 2,
                                riskLevel: 'low'
                            });
                        }
                    }
                }
                
                // å„ªå…ˆç´š3ï¼šæ¯”ä¾‹å›æ­¸
                if (signals.deviationLevel >= 2) {
                    const targetBet = metrics.bigRatio > 0.5 ? 'small' : 'big';
                    const existingSameBet = suggestions.find(s => 
                        s.type === `æŠ¼${targetBet === 'big' ? 'å¤§' : 'å°'}`);
                    
                    if (existingSameBet) {
                        existingSameBet.bets = Math.min(existingSameBet.bets + 3, MAX_BETS);
                        existingSameBet.reason += ` + è¿½å›æ­¸`;
                    } else if (suggestions.length === 0) {
                        suggestions.push({
                            type: `æŠ¼${targetBet === 'big' ? 'å¤§' : 'å°'}`,
                            reason: `ğŸ“Š è¿½å›æ­¸ï¼šå¤§ä½”${(metrics.bigRatio * 100).toFixed(0)}%`,
                            bets: calculateBets(6, 2),
                            odds: 2,
                            priority: 3,
                            riskLevel: 'medium'
                        });
                    }
                }
                
                // å„ªå…ˆç´š4ï¼šè±¹å­æŠ•æ³¨ï¼ˆç´”å¨›æ¨‚ï¼‰
                if (signals.tripleGapLevel >= 1) {
                    suggestions.push({
                        type: 'ä»»æ„è±¹å­',
                        reason: `ğŸ² ${metrics.tripleGap}æœŸæœªå‡ºè±¹å­ï¼ˆå¨›æ¨‚å˜—è©¦ï¼‰`,
                        bets: signals.tripleGapLevel === 2 ? 2 : 1,
                        odds: 30,
                        priority: 4,
                        riskLevel: 'entertainment'
                    });
                }
                
                // å„ªå…ˆç´š5ï¼šæŒ‡å®šè±¹å­
                if (signals.tripleGapLevel === 2 && metrics.hotNumbers.length > 0) {
                    suggestions.push({
                        type: `æŒ‡å®šè±¹å­ ${metrics.hotNumbers[0]}`,
                        reason: `ğŸ° ç†±è™Ÿå˜—è©¦ï¼ˆç´”å¨›æ¨‚ï¼‰`,
                        bets: 1,
                        odds: 150,
                        priority: 5,
                        riskLevel: 'entertainment'
                    });
                }
            }
            
            // ========== æ³¨ç¢¼ç®¡ç†ï¼šæ·»åŠ å»ºè­° ==========
            if (suggestions.length > 0) {
                const totalBetsNow = suggestions.reduce((sum, s) => sum + s.bets, 0);
                
                // æ·»åŠ æ³¨ç¢¼ç®¡ç†å»ºè­°
                if (suggestions[0].riskLevel === 'high') {
                    suggestions[0].betAdvice = 'å»ºè­°åˆ†æ³¨ï¼šå…ˆä¸‹ä¸€åŠï¼Œä¸­çå†è¿½';
                } else if (totalBetsNow >= 15) {
                    suggestions[0].betAdvice = 'æ³¨ç¢¼è¼ƒå¤§ï¼Œå»ºè­°è¨­å®šæ­¢æç·š';
                }
            }
            
            // å„ªå…ˆç´šæ’åº
            suggestions.sort((a, b) => a.priority - b.priority);
            
            // è¶…éä¸Šé™è™•ç†
            let totalBets = suggestions.reduce((sum, s) => sum + s.bets, 0);
            while (totalBets > MAX_BETS && suggestions.length > 0) {
                const lowest = suggestions[suggestions.length - 1];
                if (lowest.bets > 1) {
                    lowest.bets--;
                    totalBets--;
                } else {
                    suggestions.pop();
                    totalBets -= 1;
                }
            }
            
            return suggestions;
        }

        // ============================================================
        // è³‡æ–™å­˜å–ï¼ˆD8ï¼šåªå­˜åŸºæœ¬è³‡æ–™ï¼Œè®€å–æ™‚é‡æ–°è¨ˆç®—ï¼‰
        // ============================================================
        
        function loadRecords() {
            const saved = localStorage.getItem('sicBoRecords_v2');
            if (saved) {
                try {
                    const data = JSON.parse(saved);
                    // é‡æ–°è¨ˆç®—æ¯ç­†è¨˜éŒ„çš„ type/sum
                    records = data.map(recalculateRecord);
                } catch (e) {
                    console.error('è¼‰å…¥è³‡æ–™å¤±æ•—:', e);
                    records = [];
                }
            }
            
            // å˜—è©¦é·ç§»èˆŠç‰ˆè³‡æ–™
            const oldSaved = localStorage.getItem('sicBoRecords');
            if (oldSaved && records.length === 0) {
                try {
                    const oldData = JSON.parse(oldSaved);
                    records = oldData.map(r => recalculateRecord({
                        round: r.round,
                        dice: r.dice,
                        timestamp: r.timestamp
                    }));
                    saveRecords();
                    localStorage.removeItem('sicBoRecords');
                } catch (e) {
                    console.error('é·ç§»èˆŠè³‡æ–™å¤±æ•—:', e);
                }
            }
            
            updateDisplay();
        }

        function saveRecords() {
            // åªå­˜åŸºæœ¬è³‡æ–™
            const toSave = records.map(r => ({
                round: r.round,
                dice: r.dice,
                timestamp: r.timestamp
            }));
            localStorage.setItem('sicBoRecords_v2', JSON.stringify(toSave));
        }

        // ============================================================
        // è¼¸å…¥è™•ç†ï¼ˆE9ã€E10ï¼‰
        // ============================================================
        
        function addRecord() {
            let roundNum = document.getElementById('roundNum').value.trim();
            const d1 = parseInt(document.getElementById('dice1').value);
            const d2 = parseInt(document.getElementById('dice2').value);
            const d3 = parseInt(document.getElementById('dice3').value);

            // E9ï¼šæœŸæ•¸ç™½åå–®éæ¿¾
            roundNum = sanitizeRound(roundNum);
            
            if (!roundNum) {
                alert('è«‹è¼¸å…¥æœŸæ•¸ï¼ˆåƒ…å…è¨±è‹±æ•¸å­—ã€-ã€_ï¼‰');
                return;
            }

            if (isNaN(d1) || isNaN(d2) || isNaN(d3) ||
                d1 < 1 || d1 > 6 || d2 < 1 || d2 > 6 || d3 < 1 || d3 > 6) {
                alert('è«‹è¼¸å…¥æœ‰æ•ˆçš„éª°å­é»æ•¸ (1-6)');
                return;
            }

            // E10ï¼šæª¢æŸ¥æœŸæ•¸é‡è¤‡
            const existing = records.find(r => r.round === roundNum);
            if (existing) {
                if (!confirm(`æœŸæ•¸ ${roundNum} å·²å­˜åœ¨ï¼Œæ˜¯å¦è¦†è“‹ï¼Ÿ`)) {
                    return;
                }
                // ç§»é™¤èˆŠçš„
                records = records.filter(r => r.round !== roundNum);
            }

            const result = getResultType(d1, d2, d3);
            records.unshift({
                round: roundNum,
                dice: [d1, d2, d3],
                ...result,
                timestamp: Date.now()
            });

            if (records.length > MAX_RECORDS) {
                records = records.slice(0, MAX_RECORDS);
            }

            saveRecords();
            updateDisplay();

            const nextRound = autoIncrementRound(roundNum);
            document.getElementById('roundNum').value = nextRound;
            document.getElementById('dice1').value = '';
            document.getElementById('dice2').value = '';
            document.getElementById('dice3').value = '';
            document.getElementById('dice1').focus();
        }

        function autoIncrementRound(currentRound) {
            const match = currentRound.match(/^(.*?)(\d+)$/);
            if (match) {
                const prefix = match[1];
                const num = parseInt(match[2]);
                const padLength = match[2].length;
                return prefix + String(num + 1).padStart(padLength, '0');
            }
            return currentRound;
        }

        function deleteRecord(index) {
            records.splice(index, 1);
            saveRecords();
            updateDisplay();
        }

        function clearRecords() {
            if (confirm('ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰è¨˜éŒ„å—ï¼Ÿ')) {
                records = [];
                saveRecords();
                updateDisplay();
            }
        }

        // ============================================================
        // åŒ¯å…¥åŒ¯å‡ºåŠŸèƒ½ï¼ˆF11ï¼‰
        // ============================================================
        
        function toggleImport() {
            const area = document.getElementById('importArea');
            area.style.display = area.style.display === 'none' ? 'block' : 'none';
        }

        function exportData() {
            if (records.length === 0) {
                alert('æ²’æœ‰è³‡æ–™å¯åŒ¯å‡º');
                return;
            }
            
            const lines = records.map(r => `${r.round} ${r.dice.join(' ')}`).reverse();
            const text = lines.join('\n');
            
            navigator.clipboard.writeText(text).then(() => {
                alert(`å·²è¤‡è£½ ${records.length} ç­†è³‡æ–™åˆ°å‰ªè²¼ç°¿ï¼\n\næ ¼å¼ï¼šæœŸæ•¸ éª°1 éª°2 éª°3`);
            }).catch(() => {
                // Fallback
                const textarea = document.createElement('textarea');
                textarea.value = text;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                alert(`å·²è¤‡è£½ ${records.length} ç­†è³‡æ–™ï¼`);
            });
        }

        function importData() {
            const text = document.getElementById('importText').value.trim();
            if (!text) {
                alert('è«‹è¼¸å…¥è¦åŒ¯å…¥çš„è³‡æ–™');
                return;
            }
            
            const lines = text.split('\n').filter(line => line.trim());
            const newRecords = [];
            const errors = [];
            
            lines.forEach((line, i) => {
                const parts = line.trim().split(/[\s,]+/);
                if (parts.length >= 4) {
                    const round = sanitizeRound(parts[0]);
                    const d1 = parseInt(parts[1]);
                    const d2 = parseInt(parts[2]);
                    const d3 = parseInt(parts[3]);
                    
                    if (round && !isNaN(d1) && !isNaN(d2) && !isNaN(d3) &&
                        d1 >= 1 && d1 <= 6 && d2 >= 1 && d2 <= 6 && d3 >= 1 && d3 <= 6) {
                        const result = getResultType(d1, d2, d3);
                        newRecords.push({
                            round,
                            dice: [d1, d2, d3],
                            ...result,
                            timestamp: Date.now() - (lines.length - i) * 1000
                        });
                    } else {
                        errors.push(`ç¬¬ ${i + 1} è¡Œæ ¼å¼éŒ¯èª¤`);
                    }
                } else {
                    errors.push(`ç¬¬ ${i + 1} è¡Œæ ¼å¼éŒ¯èª¤`);
                }
            });
            
            if (newRecords.length > 0) {
                // åˆä½µï¼šæ–°è³‡æ–™æ”¾å‰é¢ï¼Œå»é‡
                const existingRounds = new Set(records.map(r => r.round));
                const uniqueNew = newRecords.filter(r => !existingRounds.has(r.round));
                
                records = [...uniqueNew.reverse(), ...records].slice(0, MAX_RECORDS);
                saveRecords();
                updateDisplay();
                
                document.getElementById('importText').value = '';
                document.getElementById('importArea').style.display = 'none';
                
                let msg = `æˆåŠŸåŒ¯å…¥ ${uniqueNew.length} ç­†è³‡æ–™ï¼`;
                if (errors.length > 0) {
                    msg += `\n\nä»¥ä¸‹è¡Œæ•¸æœ‰éŒ¯èª¤ï¼š\n${errors.slice(0, 5).join('\n')}`;
                    if (errors.length > 5) msg += `\n...åŠå…¶ä»– ${errors.length - 5} è¡Œ`;
                }
                alert(msg);
            } else {
                alert('æ²’æœ‰æœ‰æ•ˆçš„è³‡æ–™å¯åŒ¯å…¥\n\n' + errors.slice(0, 5).join('\n'));
            }
        }

        // ============================================================
        // æ¸²æŸ“å‡½æ•¸ï¼ˆG13ï¼šåˆ†é›¢æ¸²æŸ“é‚è¼¯ï¼‰
        // ============================================================
        
        function getAnalysisWindow() {
            const select = document.getElementById('analysisWindow');
            return parseInt(select.value) || 0;
        }

        function updateDisplay() {
            const windowSize = getAnalysisWindow();
            const metrics = computeMetrics(records, windowSize || records.length);
            const signals = records.length >= 3 ? computeSignals(metrics) : null;
            
            renderCurrentResult();
            renderHistory();
            renderStats(metrics);
            renderTrends(metrics);
            renderRoadmap();
            renderBetSuggestion(signals, metrics);
        }

        function renderCurrentResult() {
            const container = document.getElementById('currentResult');
            if (records.length === 0) {
                container.style.display = 'none';
                return;
            }

            container.style.display = 'flex';
            const latest = records[0];

            document.getElementById('displayRound').textContent = escapeHtml(latest.round || '-');
            document.getElementById('display1').textContent = latest.dice[0];
            document.getElementById('display2').textContent = latest.dice[1];
            document.getElementById('display3').textContent = latest.dice[2];
            document.getElementById('displaySum').textContent = latest.sum;

            const typeEl = document.getElementById('resultType');
            typeEl.className = 'result-type';

            if (latest.type === 'triple') {
                typeEl.textContent = `è±¹å­ ${latest.tripleNumber}`;
                typeEl.classList.add('result-triple');
            } else if (latest.type === 'big') {
                typeEl.textContent = 'å¤§';
                typeEl.classList.add('result-big');
            } else {
                typeEl.textContent = 'å°';
                typeEl.classList.add('result-small');
            }
        }

        function renderHistory() {
            const tbody = document.getElementById('historyBody');
            tbody.innerHTML = records.map((r, i) => {
                let badge = '';
                if (r.type === 'triple') {
                    badge = `<span class="badge badge-triple">è±¹${r.tripleNumber}</span>`;
                } else if (r.type === 'big') {
                    badge = '<span class="badge badge-big">å¤§</span>';
                } else {
                    badge = '<span class="badge badge-small">å°</span>';
                }

                return `
                    <tr${i === 0 ? ' style="background: rgba(255, 215, 0, 0.1);"' : ''}>
                        <td style="color: #ffd700; font-weight: bold;">${escapeHtml(r.round || '-')}</td>
                        <td>${r.dice[0]}</td>
                        <td>${r.dice[1]}</td>
                        <td>${r.dice[2]}</td>
                        <td>${r.sum}</td>
                        <td>${badge}</td>
                        <td><button onclick="deleteRecord(${i})" style="background:none;border:none;color:#ff4757;cursor:pointer;font-size:1.1rem;">âœ•</button></td>
                    </tr>
                `;
            }).join('');

            document.getElementById('recordCount').textContent = `ç›®å‰ ${records.length} ç­†è¨˜éŒ„`;
        }

        function renderStats(metrics) {
            document.getElementById('bigCount').textContent = metrics.bigCount;
            document.getElementById('smallCount').textContent = metrics.smallCount;
            document.getElementById('tripleCount').textContent = metrics.tripleCount;

            const total = metrics.total;
            document.getElementById('bigPercent').textContent = total ? `${(metrics.bigCount / total * 100).toFixed(0)}%` : '0%';
            document.getElementById('smallPercent').textContent = total ? `${(metrics.smallCount / total * 100).toFixed(0)}%` : '0%';
            document.getElementById('triplePercent').textContent = total ? `${(metrics.tripleCount / total * 100).toFixed(0)}%` : '0%';

            document.getElementById('bigCountAll').textContent = `å…¨${metrics.allTotal}æœŸ: ${metrics.allBig}`;
            document.getElementById('smallCountAll').textContent = `å…¨${metrics.allTotal}æœŸ: ${metrics.allSmall}`;
            document.getElementById('tripleCountAll').textContent = `å…¨${metrics.allTotal}æœŸ: ${metrics.allTriple}`;

            // åˆ†æç¯„åœ
            if (records.length > 0) {
                const windowSize = getAnalysisWindow();
                const displayWindow = windowSize > 0 ? Math.min(windowSize, records.length) : records.length;
                document.getElementById('analysisRange').textContent = `(åˆ†æ ${displayWindow} æœŸ)`;
            } else {
                document.getElementById('analysisRange').textContent = '';
            }

            // è·¯å‹åˆ†æ
            const pattern = analyzePattern(records);
            renderPattern(pattern);

            // é€£çºŒè¶¨å‹¢èˆ‡é¾å‹¢
            const streak = metrics.currentStreak;
            const dragon = metrics.dragon;
            
            document.getElementById('currentStreak').textContent = streak.count || '-';
            document.getElementById('streakType').textContent = 
                streak.type === 'big' ? 'é€£å¤§' : 
                streak.type === 'small' ? 'é€£å°' : 
                streak.type === 'triple' ? '(è±¹å­)' : '-';
            
            // é¾å‹¢ç‹€æ…‹
            const dragonStatusEl = document.getElementById('dragonStatus');
            if (dragon && dragon.status !== 'none') {
                dragonStatusEl.textContent = getDragonStatusText(dragon);
                dragonStatusEl.style.color = getDragonStatusColor(dragon);
            } else {
                dragonStatusEl.textContent = '-';
                dragonStatusEl.style.color = '#888';
            }
            
            document.getElementById('maxBigStreak').textContent = metrics.maxStreaks.maxBig;
            document.getElementById('maxSmallStreak').textContent = metrics.maxStreaks.maxSmall;
        }
        
        // æ¸²æŸ“è·¯å‹åˆ†æ
        function renderPattern(pattern) {
            const typeEl = document.getElementById('patternType');
            const descEl = document.getElementById('patternDesc');
            const confEl = document.getElementById('patternConfidence');
            const predictEl = document.getElementById('patternPredict');
            
            if (!pattern || pattern.type === 'insufficient') {
                typeEl.textContent = 'ğŸ“Š';
                typeEl.style.color = '#888';
                descEl.textContent = 'éœ€è¦æ›´å¤šæ•¸æ“šï¼ˆè‡³å°‘4æœŸï¼‰';
                confEl.textContent = '-';
                predictEl.textContent = '-';
                predictEl.style.color = '#888';
                return;
            }
            
            // è·¯å‹é¡å‹èˆ‡é¡è‰²
            const typeConfig = {
                singleJump: { icon: 'ğŸ”€ å–®è·³', color: '#9b59b6' },
                doubleJump: { icon: 'ğŸ”„ é›™è·³', color: '#3498db' },
                dragon: { icon: 'ğŸ‰ é•·é¾', color: '#2ecc71' },
                random: { icon: 'ğŸ“Š äº‚è·¯', color: '#888' }
            };
            
            const config = typeConfig[pattern.type] || typeConfig.random;
            typeEl.textContent = config.icon;
            typeEl.style.color = config.color;
            descEl.textContent = pattern.description || '-';
            
            // ä¿¡å¿ƒåº¦
            if (pattern.confidence) {
                confEl.textContent = `${pattern.confidence.toFixed(0)}%`;
                confEl.style.color = pattern.confidence >= 70 ? '#2ecc71' : 
                                     pattern.confidence >= 50 ? '#f39c12' : '#888';
            } else {
                confEl.textContent = '-';
            }
            
            // é æ¸¬
            if (pattern.nextPredict) {
                predictEl.textContent = pattern.nextPredict === 'big' ? 'å¤§' : 'å°';
                predictEl.style.color = pattern.nextPredict === 'big' ? '#e74c3c' : '#3498db';
            } else if (pattern.currentType) {
                // é•·é¾æ™‚é¡¯ç¤ºç•¶å‰æ–¹å‘
                predictEl.textContent = `çºŒ${pattern.currentType === 'big' ? 'å¤§' : 'å°'}?`;
                predictEl.style.color = pattern.currentType === 'big' ? '#e74c3c' : '#3498db';
            } else {
                predictEl.textContent = '-';
                predictEl.style.color = '#888';
            }
        }

        function renderTrends(metrics) {
            // å„é»æ•¸çµ±è¨ˆ
            const totalDice = metrics.total * 3;
            const avgCount = totalDice / 6;
            
            document.getElementById('numberTrend').innerHTML = metrics.numberCounts.map((count, i) => {
                let status = 'warm', statusText = 'æº«';
                if (totalDice > 0) {
                    const ratio = count / avgCount;
                    if (ratio >= 1.4) { status = 'hot'; statusText = 'ç†±'; }
                    else if (ratio <= 0.6) { status = 'cold'; statusText = 'å†·'; }
                }
                return `
                    <div class="trend-item">
                        <div class="number">${i + 1}</div>
                        <div class="count">${count}æ¬¡</div>
                        <span class="status ${status}">${statusText}</span>
                    </div>
                `;
            }).join('');

            // ç¸½å’Œåˆ†å¸ƒ
            const nonTripleCount = metrics.bigCount + metrics.smallCount;
            const avgSum = nonTripleCount / 14;
            
            document.getElementById('sumTrend').innerHTML = Object.entries(metrics.sumCounts).map(([sum, count]) => {
                let status = 'warm', statusText = 'æº«';
                if (nonTripleCount > 0) {
                    const ratio = count / avgSum;
                    if (ratio >= 1.8) { status = 'hot'; statusText = 'ç†±'; }
                    else if (ratio <= 0.3 || count === 0) { status = 'cold'; statusText = 'å†·'; }
                }
                const isBig = parseInt(sum) >= 12;
                return `
                    <div class="trend-item" style="border-left: 3px solid ${isBig ? '#e74c3c' : '#3498db'}">
                        <div class="number" style="font-size: 1rem;">${sum}</div>
                        <div class="count">${count}</div>
                        <span class="status ${status}">${statusText}</span>
                    </div>
                `;
            }).join('');
        }

        function renderRoadmap() {
            document.getElementById('roadmap').innerHTML = [...records].reverse().map(r => {
                let cls = 'roadmap-';
                let text = '';
                if (r.type === 'triple') {
                    cls += 'triple';
                    text = r.tripleNumber;
                } else if (r.type === 'big') {
                    cls += 'big';
                    text = 'å¤§';
                } else {
                    cls += 'small';
                    text = 'å°';
                }
                const tooltip = `ç¬¬${escapeHtml(r.round || '?')}æœŸ: ${r.dice.join(',')}=${r.sum}`;
                return `<div class="roadmap-cell ${cls}" title="${tooltip}">${text}</div>`;
            }).join('');
        }

        function renderBetSuggestion(signals, metrics) {
            const container = document.getElementById('betSuggestion');
            const nextRoundHint = document.getElementById('nextRoundHint');
            
            if (records.length > 0) {
                const latestRound = records[0].round || '?';
                const nextRound = autoIncrementRound(latestRound);
                nextRoundHint.textContent = `(åŸºæ–¼ç¬¬${escapeHtml(latestRound)}æœŸï¼Œå»ºè­°ç¬¬${escapeHtml(nextRound)}æœŸ)`;
            } else {
                nextRoundHint.textContent = '';
            }
            
            if (!signals) {
                container.innerHTML = '<p style="text-align: center; color: #888;">è«‹å…ˆè¼¸å…¥è‡³å°‘3ç­†é–‹çè¨˜éŒ„</p>';
                document.getElementById('confidenceFill').style.width = '0%';
                document.getElementById('confidenceText').textContent = '0%';
                return;
            }

            const { confidence, reasons } = computeConfidence(signals);
            const suggestions = generateSuggestions(signals, currentStrategy);
            
            let html = '';
            let totalBets = 0;

            suggestions.forEach(s => {
                totalBets += s.bets;
                
                // é¢¨éšªç­‰ç´šé¡è‰²
                const riskColors = {
                    low: '#2ecc71',
                    medium: '#f39c12',
                    high: '#e74c3c',
                    entertainment: '#9b59b6'
                };
                const riskLabels = {
                    low: 'ä½é¢¨éšª',
                    medium: 'ä¸­é¢¨éšª',
                    high: 'é«˜é¢¨éšª',
                    entertainment: 'å¨›æ¨‚'
                };
                const riskColor = riskColors[s.riskLevel] || '#888';
                const riskLabel = riskLabels[s.riskLevel] || '';
                
                html += `
                    <div class="bet-item">
                        <div>
                            <div class="bet-type">${escapeHtml(s.type)}
                                ${riskLabel ? `<span style="font-size: 0.75rem; padding: 2px 6px; margin-left: 8px; border-radius: 4px; background: ${riskColor}33; color: ${riskColor};">${riskLabel}</span>` : ''}
                            </div>
                            <div class="bet-odds">${escapeHtml(s.reason || '')}</div>
                            ${s.warning ? `<div style="color: #f39c12; font-size: 0.8rem; margin-top: 4px;">âš ï¸ ${escapeHtml(s.warning)}</div>` : ''}
                            ${s.betAdvice ? `<div style="color: #3498db; font-size: 0.8rem; margin-top: 4px;">ğŸ’¡ ${escapeHtml(s.betAdvice)}</div>` : ''}
                        </div>
                        <div style="text-align: right;">
                            <div class="bet-amount">${s.bets}æ³¨ ($${(s.bets * BET_UNIT).toLocaleString()})</div>
                            <div class="bet-odds">è³ ç‡ 1:${s.odds} â†’ $${(s.bets * BET_UNIT * s.odds).toLocaleString()}</div>
                        </div>
                    </div>
                `;
            });

            if (suggestions.length === 0) {
                if (currentStrategy === 'aggressive') {
                    html = '<p style="text-align: center; color: #888;">æ¿€é€²ç­–ç•¥ç›®å‰ç„¡å¼·ä¿¡è™Ÿï¼Œå»ºè­°åˆ‡æ›ä¿å®ˆç­–ç•¥æˆ–è§€æœ›</p>';
                } else {
                    html = '<p style="text-align: center; color: #888;">æ•¸æ“šä¸è¶³ï¼Œè«‹ç¹¼çºŒè¼¸å…¥é–‹çè¨˜éŒ„</p>';
                }
            } else {
                html += `
                    <div class="total-bet">
                        <span>ç¸½æŠ•æ³¨</span>
                        <span class="amount">${totalBets}æ³¨ ($${(totalBets * BET_UNIT).toLocaleString()})</span>
                    </div>
                `;
            }

            html += `<div style="margin-top: 15px; padding: 10px; background: rgba(0,0,0,0.2); border-radius: 8px;">
                <strong>åˆ†æä¾æ“šï¼š</strong><br>
                <span style="color: #888; font-size: 0.9rem;">${escapeHtml(reasons.join('ï¼›') || 'ç´¯ç©æ›´å¤šæ•¸æ“šå¯æé«˜åˆ†ææº–ç¢ºåº¦')}</span>
            </div>`;

            container.innerHTML = html;

            // æ›´æ–°ä¿¡å¿ƒæŒ‡æ•¸ï¼ˆå„ªåŒ–é–€æª»ï¼š40/65ï¼‰
            const fillEl = document.getElementById('confidenceFill');
            fillEl.style.width = `${confidence}%`;
            fillEl.className = 'meter-fill ' + 
                (confidence < 40 ? 'meter-low' : confidence < 65 ? 'meter-medium' : 'meter-high');
            document.getElementById('confidenceText').textContent = `${confidence}%`;
        }

        // ============================================================
        // UI äº’å‹•
        // ============================================================
        
        function setStrategy(strategy) {
            currentStrategy = strategy;
            document.querySelectorAll('.strategy-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`.strategy-btn.${strategy}`).classList.add('active');
            updateStrategyExplain();
            updateDisplay();
        }

        function updateStrategyExplain() {
            const explainEl = document.getElementById('strategyExplain');
            
            if (currentStrategy === 'conservative') {
                explainEl.innerHTML = `
                    <div class="title">ğŸ›¡ï¸ ä¿å®ˆç­–ç•¥åŸå‰‡ï¼ˆç©æ¥µå»ºè­°ãƒ»ä¿å®ˆæ³¨ç¢¼ï¼‰</div>
                    <p style="color: #2ecc71; font-size: 0.9em; margin-bottom: 10px;">ğŸ’¡ ä¿å®ˆ = å°æ³¨å¤šå‡ºæ‰‹ï¼Œè€Œéä¸å‡ºæ‰‹</p>
                    <ul>
                        <li><strong>ğŸ”€ å–®è·³è·¯</strong>ï¼ˆâ‰¥60%ï¼‰ï¼š3-5æ³¨è·Ÿè·³</li>
                        <li><strong>ğŸ”„ é›™è·³è·¯</strong>ï¼ˆâ‰¥55%ï¼‰ï¼š3-4æ³¨è·Ÿè·¯</li>
                        <li><strong>ğŸ‰ è·Ÿé¾</strong>ï¼šé€£<span style="color:#2ecc71">3æœŸ</span>å³å¯å°æ³¨è·Ÿï¼ˆ3-5æ³¨ï¼‰</li>
                        <li><strong>âš”ï¸ æ–·é¾</strong>ï¼šé€£<span style="color:#ffd700">7æœŸ</span>ä»¥ä¸ŠåæŠ¼ï¼ˆ4-5æ³¨ï¼‰</li>
                        <li><strong style="color:#f39c12;">ğŸ”„ å›é¾</strong>ï¼šé•·é¾å‰›æ–·æŠ¼å›ï¼ˆ4æ³¨ï¼‰</li>
                        <li><strong>ğŸ“Š è¿½å›æ­¸</strong>ï¼šæ¯”ä¾‹åé›¢>25%æ™‚å‡ºæ‰‹ï¼ˆ3-4æ³¨ï¼‰</li>
                        <li><strong>ğŸ“ˆ è¶¨å‹¢å»¶çºŒ</strong>ï¼šé€£2æœŸåŒå‘ï¼Œå°æ³¨è·Ÿéš¨ï¼ˆ2æ³¨ï¼‰</li>
                        <li><strong>ğŸ’¡ å…œåº•å»ºè­°</strong>ï¼šç„¡æ˜ç¢ºä¿¡è™Ÿæ™‚ï¼Œæ ¹æ“šè¿‘æ³çµ¦æœ€å°æ³¨ï¼ˆ2æ³¨ï¼‰</li>
                    </ul>
                    <p style="color: #888; font-size: 0.85em; margin-top: 8px;">æ³¨ç¢¼ç¯„åœï¼š2-5æ³¨ï¼ˆ$10,000-$25,000ï¼‰</p>
                `;
            } else {
                explainEl.innerHTML = `
                    <div class="title">âš”ï¸ æ¿€é€²ç­–ç•¥åŸå‰‡ï¼ˆå¤šé‡ä¿¡è™Ÿãƒ»ç©æ¥µè¿½æ“Šï¼‰</div>
                    <ul>
                        <li><strong>ğŸ¯ è·¯å‹å„ªå…ˆ</strong>ï¼šå–®è·³/é›™è·³è·¯å‹æ˜é¡¯æ™‚å„ªå…ˆè·Ÿè·¯</li>
                        <li><strong>ğŸ‰ è·Ÿé¾</strong>ï¼šé€£çºŒ<span style="color:#2ecc71">3æœŸ</span>å³è·Ÿï¼ˆæ—©æœŸä»‹å…¥ï¼‰</li>
                        <li><strong>âš”ï¸ æ–·é¾</strong>ï¼šé€£çºŒ<span style="color:#ffd700">6æœŸ</span>ä»¥ä¸Šå¤§æ³¨åæŠ¼
                            <ul style="font-size: 0.85em; margin-top: 5px;">
                                <li>6æœŸ â†’ 10æ³¨ ï½œ 7æœŸ â†’ 15æ³¨ ï½œ 8æœŸ+ â†’ 20æ³¨</li>
                            </ul>
                        </li>
                        <li><strong style="color:#f39c12;">ğŸ”„ å›é¾</strong>ï¼šé•·é¾å‰›æ–·å¾Œï¼Œç©æ¥µæŠ¼å›åŸæ–¹å‘ï¼ˆ8æ³¨ï¼‰
                            <ul style="font-size: 0.85em; margin-top: 5px;">
                                <li>è±¹å­ä¸­æ–·é•·é¾æ™‚ä¹Ÿé©ç”¨å›é¾ç­–ç•¥</li>
                            </ul>
                        </li>
                        <li><strong>ğŸ”— ä¿¡è™Ÿç–ŠåŠ </strong>ï¼šå¤šé‡ä¿¡è™ŸåŒå‘æ™‚åŠ æ³¨è¿½æ“Š</li>
                        <li><strong>ğŸ² è±¹å­å¨›æ¨‚</strong>ï¼š15æœŸ+æœªå‡ºè±¹å­æ™‚å°æ³¨å˜—è©¦</li>
                        <li style="color: #f39c12;"><strong>âš ï¸ é¢¨éšªæç¤º</strong>ï¼šå»ºè­°è¨­å®šæ­¢æç·šï¼ˆå¦‚é€£è™§3æŠŠä¼‘æ¯ï¼‰</li>
                    </ul>
                `;
            }
            explainEl.classList.add('show');
        }

        function toggleConfidenceDetail() {
            const detailEl = document.getElementById('confidenceDetail');
            detailEl.style.display = detailEl.style.display === 'none' ? 'block' : 'none';
        }

        // Enter éµå¿«é€Ÿè¼¸å…¥
        document.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                const active = document.activeElement;
                if (active.id === 'roundNum') document.getElementById('dice1').focus();
                else if (active.id === 'dice1') document.getElementById('dice2').focus();
                else if (active.id === 'dice2') document.getElementById('dice3').focus();
                else if (active.id === 'dice3') addRecord();
            }
        });

        // éª°å­è¼¸å…¥è‡ªå‹•è·³ä¸‹ä¸€æ ¼
        function setupAutoJump() {
            ['dice1', 'dice2', 'dice3'].forEach((id, i) => {
                document.getElementById(id).addEventListener('input', (e) => {
                    const val = e.target.value;
                    if (val >= 1 && val <= 6) {
                        if (i < 2) {
                            const next = document.getElementById(['dice1', 'dice2', 'dice3'][i + 1]);
                            next.focus();
                            next.select();
                        } else {
                            setTimeout(() => addRecord(), 100);
                        }
                    }
                });
            });
        }

        // ============================================================
        // åˆå§‹åŒ–
        // ============================================================
        loadRecords();
        setupAutoJump();
        updateStrategyExplain();
    </script>
</body>
</html>
