<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å‚·å®³è¨ˆç®—æ©Ÿ</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #f5f7fa;
            --bg-secondary: #ffffff;
            --bg-card: #ffffff;
            --accent-gold: #e67e22;
            --accent-silver: #7f8c8d;
            --accent-bronze: #a0522d;
            --accent-blue: #3498db;
            --accent-red: #e74c3c;
            --accent-green: #27ae60;
            --accent-purple: #9b59b6;
            --accent-orange: #f39c12;
            --accent-cyan: #1abc9c;
            --accent-pink: #e91e63;
            --text-primary: #2c3e50;
            --text-secondary: #7f8c8d;
            --border-color: #dce4ec;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Noto Sans TC', sans-serif;
            background: var(--bg-primary);
            background-image: 
                radial-gradient(ellipse at top left, rgba(52, 152, 219, 0.08) 0%, transparent 50%),
                radial-gradient(ellipse at bottom right, rgba(230, 126, 34, 0.08) 0%, transparent 50%);
            min-height: 100vh;
            color: var(--text-primary);
            padding: 15px;
            font-size: 18px;
        }

        .container { max-width: 1400px; margin: 0 auto; }

        h1 {
            text-align: center;
            font-size: clamp(1.5rem, 5vw, 2.5rem);
            margin-bottom: 20px;
            background: linear-gradient(135deg, var(--accent-gold), var(--accent-blue));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .calculator-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
        }

        .card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
        }

        .card-title {
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--accent-gold);
            color: var(--accent-gold);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 8px;
        }

        .input-group { margin-bottom: 12px; }

        .input-group label {
            display: block;
            margin-bottom: 5px;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .input-group input[type="number"],
        .input-group select,
        .input-group input[type="text"] {
            width: 100%;
            padding: 12px 15px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 16px;
            transition: border-color 0.3s, box-shadow 0.3s;
        }

        .input-group input:focus,
        .input-group select:focus {
            outline: none;
            border-color: var(--accent-blue);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.15);
        }

        .skill-input-row {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 8px;
        }

        .skill-input-row input[type="range"] { 
            flex: 1; 
            margin: 0;
            height: 30px;
        }

        .skill-input-row input[type="number"] {
            width: 75px;
            padding: 10px 8px;
            text-align: center;
            background: var(--bg-secondary);
            border: 2px solid var(--accent-blue);
            border-radius: 8px;
            color: var(--accent-blue);
            font-size: 16px;
            font-weight: 700;
        }

        .skill-input-row .percent-sign {
            color: var(--accent-blue);
            font-weight: 700;
        }

        .input-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        select option {
            background: var(--bg-secondary);
            color: var(--text-primary);
        }

        .toggle-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
            padding: 8px 0;
        }

        .toggle-switch {
            position: relative;
            width: 50px;
            height: 28px;
            flex-shrink: 0;
        }

        .toggle-switch input { opacity: 0; width: 0; height: 0; }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: #ccd5de;
            border: 1px solid var(--border-color);
            transition: 0.3s;
            border-radius: 28px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 2px;
            bottom: 2px;
            background-color: #fff;
            transition: 0.3s;
            border-radius: 50%;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }

        .toggle-switch input:checked + .toggle-slider {
            background-color: var(--accent-blue);
            border-color: var(--accent-blue);
        }

        .toggle-switch input:checked + .toggle-slider:before {
            transform: translateX(22px);
            background-color: #fff;
        }

        .toggle-label { color: var(--text-secondary); font-size: 0.95rem; }

        .btn-calculate {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, var(--accent-gold), #ff8f00);
            border: none;
            border-radius: 8px;
            color: #000;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-top: 10px;
        }

        .btn-calculate:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(249, 168, 37, 0.4);
        }

        .btn-add-compare {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, var(--accent-purple), #7b1fa2);
            border: none;
            border-radius: 8px;
            color: #fff;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-top: 10px;
        }

        .btn-add-compare:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(171, 71, 188, 0.4);
        }

        .btn-clear-list {
            padding: 6px 14px;
            background: transparent;
            border: 1px solid var(--accent-red);
            border-radius: 5px;
            color: var(--accent-red);
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-clear-list:hover {
            background: var(--accent-red);
            color: #fff;
        }

        /* çµæœå€åŸŸ */
        .results-section {
            grid-column: 1 / -1;
            margin-top: 15px;
        }

        .results-card {
            background: linear-gradient(135deg, #fff, #fef9f3);
            border: 2px solid var(--accent-gold);
        }

        /* åŸºç¤æ•¸å€¼å€ */
        .base-results {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px dashed var(--border-color);
        }

        .base-result-item {
            background: #f8f9fa;
            padding: 12px 8px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid var(--border-color);
        }

        .base-result-label {
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-bottom: 5px;
        }

        .base-result-value {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--accent-blue);
        }

        .base-result-value.gold { color: var(--accent-gold); }
        .base-result-value.orange { color: var(--accent-orange); }

        /* ä¿®æ­£å€¼é¡¯ç¤º */
        .modifier-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px dashed var(--border-color);
        }

        .modifier-item {
            background: #f8f9fa;
            padding: 10px 12px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 8px;
            border: 1px solid var(--border-color);
        }

        .modifier-label { color: var(--text-secondary); font-size: 0.85rem; }
        .modifier-value { font-weight: 700; font-size: 0.95rem; }
        .modifier-positive { color: var(--accent-green); }
        .modifier-negative { color: var(--accent-red); }
        .modifier-neutral { color: var(--text-secondary); }

        /* æ”¹é€ å€ç‡è¡¨ */
        .reform-table-section {
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px dashed var(--border-color);
        }

        .reform-table-title {
            font-size: 0.9rem;
            color: var(--accent-orange);
            margin-bottom: 10px;
            font-weight: 600;
        }

        .reform-table {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 6px;
            font-size: 0.8rem;
        }

        .reform-table-cell {
            background: #f0f3f7;
            padding: 8px 4px;
            border-radius: 6px;
            text-align: center;
        }

        .reform-table-cell.header {
            color: var(--text-secondary);
            font-weight: 500;
        }

        .reform-table-cell.active {
            background: var(--accent-orange);
            color: #000;
            font-weight: 700;
        }

        /* å‚·å®³çµæœå€ */
        .damage-results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
        }

        .damage-box {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 12px;
            border: 1px solid var(--border-color);
        }

        .damage-box-title {
            font-size: 0.95rem;
            font-weight: 700;
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            gap: 6px;
            flex-wrap: wrap;
        }

        .damage-box.normal-atk { border-color: var(--accent-cyan); }
        .damage-box.normal-atk .damage-box-title { color: var(--accent-cyan); }
        .damage-box.no-crit .damage-box-title { color: var(--accent-silver); }
        .damage-box.with-crit .damage-box-title { color: var(--accent-orange); }
        .damage-box.with-boss .damage-box-title { color: var(--accent-red); }

        .damage-box.highlight {
            border-color: var(--accent-gold);
            background: linear-gradient(135deg, #fffbf5, #fff3e0);
        }
        .damage-box.highlight .damage-box-title { color: var(--accent-gold); }

        .tag {
            font-size: 0.65rem;
            padding: 2px 5px;
            border-radius: 4px;
            font-weight: 600;
        }

        .tag-normal { background: var(--accent-cyan); color: #fff; }
        .tag-skill { background: var(--accent-purple); color: #fff; }
        .tag-crit { background: var(--accent-orange); color: #fff; }
        .tag-no-crit { background: #bdc3c7; color: #555; }
        .tag-boss { background: var(--accent-red); color: #fff; }
        .tag-no-boss { background: #dce4ec; color: #777; }

        .damage-category {
            margin-bottom: 20px;
        }

        .damage-category:last-child {
            margin-bottom: 0;
        }

        .damage-category-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 12px;
            padding: 8px 12px;
            background: #f0f3f7;
            border-radius: 6px;
            border-left: 4px solid var(--accent-blue);
        }

        .damage-category:last-child .damage-category-title {
            border-left-color: var(--accent-red);
        }

        .damage-values {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
        }

        .damage-stat { text-align: center; }
        .damage-stat-label { font-size: 0.7rem; color: var(--text-secondary); margin-bottom: 3px; }
        .damage-stat-value { font-size: 1.1rem; font-weight: 700; }
        .damage-stat.min .damage-stat-value { color: var(--accent-green); }
        .damage-stat.avg .damage-stat-value { color: var(--accent-blue); }
        .damage-stat.max .damage-stat-value { color: var(--accent-red); }

        /* æ”¹é€ ç­‰ç´šæ¨™ç±¤ */
        .reform-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 13px;
            font-weight: 600;
            white-space: nowrap;
        }

        .reform-0 { background: #bdc3c7; color: #555; }
        .reform-1 { background: #2e7d32; color: #fff; }
        .reform-2 { background: #1976d2; color: #fff; }
        .reform-3 { background: #7b1fa2; color: #fff; }
        .reform-4 { background: #c62828; color: #fff; }
        .reform-5 { background: linear-gradient(135deg, #f9a825, #ff6f00); color: #000; }

        .skill-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 13px;
            font-weight: 600;
            background: linear-gradient(135deg, #00bcd4, #0097a7);
            color: #fff;
            white-space: nowrap;
        }

        .grade-normal { color: var(--accent-bronze); }
        .grade-silver { color: var(--accent-silver); }
        .grade-gold { color: var(--accent-gold); }

        /* æ¯”è¼ƒæ¸…å–® */
        .compare-list-card {
            background: linear-gradient(135deg, #fff, #f8f5ff);
            border: 2px solid var(--accent-purple);
        }

        .compare-list-card .card-title {
            border-bottom-color: var(--accent-purple);
            color: var(--accent-purple);
        }

        .compare-list-empty {
            text-align: center;
            padding: 30px 15px;
            color: var(--text-secondary);
        }

        .compare-list-empty .icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
            opacity: 0.5;
        }

        .compare-list-scroll {
            max-height: 500px;
            overflow-x: auto;
            overflow-y: auto;
        }

        .compare-list-scroll::-webkit-scrollbar { width: 8px; height: 8px; }
        .compare-list-scroll::-webkit-scrollbar-track { background: var(--bg-secondary); border-radius: 4px; }
        .compare-list-scroll::-webkit-scrollbar-thumb { background: var(--border-color); border-radius: 4px; }
        .compare-list-scroll::-webkit-scrollbar-thumb:hover { background: var(--accent-purple); }

        .compare-list-table {
            width: 100%;
            min-width: 1400px;
            border-collapse: collapse;
            font-size: 15px;
        }

        .compare-list-table th {
            background: #f0f3f7;
            padding: 12px 8px;
            text-align: center;
            color: var(--text-secondary);
            font-weight: 600;
            position: sticky;
            top: 0;
            white-space: nowrap;
            font-size: 15px;
            border: 1px solid var(--border-color);
        }

        .compare-list-table thead tr:first-child th {
            top: 0;
        }

        .compare-list-table thead tr:nth-child(2) th {
            top: 42px;
            background: #e8ecf0;
            font-size: 14px;
        }

        .compare-list-table th:first-child { text-align: left; padding-left: 12px; }

        .compare-list-table td {
            padding: 12px 8px;
            text-align: center;
            border-bottom: 1px solid var(--border-color);
            white-space: nowrap;
        }

        .compare-list-table td:first-child { text-align: left; padding-left: 12px; }

        .compare-list-table tbody tr:hover { background: rgba(171, 71, 188, 0.1); }

        .compare-list-table .item-name {
            font-weight: 600;
            color: var(--accent-purple);
            max-width: 110px;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .compare-list-table .dmg-cell {
            font-weight: 600;
            font-size: 15px;
        }

        .btn-delete-item {
            background: transparent;
            border: none;
            color: var(--accent-red);
            cursor: pointer;
            font-size: 1.2rem;
            padding: 5px;
            opacity: 0.7;
            transition: opacity 0.2s;
        }

        .btn-delete-item:hover { opacity: 1; }

        .btn-set-base {
            background: transparent;
            border: 1px solid var(--accent-cyan);
            color: var(--accent-cyan);
            cursor: pointer;
            font-size: 13px;
            padding: 5px 10px;
            border-radius: 4px;
            transition: all 0.2s;
            white-space: nowrap;
        }

        .btn-set-base:hover {
            background: var(--accent-cyan);
            color: #000;
        }

        .btn-set-base.active {
            background: var(--accent-gold);
            border-color: var(--accent-gold);
            color: #000;
            font-weight: 600;
        }

        .base-row {
            background: rgba(230, 126, 34, 0.12) !important;
        }

        .base-row td:first-child::before {
            content: 'â­';
            font-size: 14px;
        }

        .base-indicator {
            display: inline-block;
            background: var(--accent-gold);
            color: #000;
            font-size: 12px;
            padding: 3px 6px;
            border-radius: 4px;
            margin-left: 6px;
            font-weight: 600;
        }

        .highlight-row { animation: highlightFade 2s ease-out; }

        @keyframes highlightFade {
            0% { background: rgba(155, 89, 182, 0.2); }
            100% { background: transparent; }
        }

        .list-diff-positive { color: var(--accent-green); font-weight: 600; font-size: 13px; }
        .list-diff-negative { color: var(--accent-red); font-weight: 600; font-size: 13px; }

        .status-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 13px;
            font-weight: 600;
            white-space: nowrap;
        }

        .status-yes { background: var(--accent-green); color: #fff; }
        .status-no { background: #bdc3c7; color: #555; }

        /* æ‰‹æ©Ÿç‰ˆå„ªåŒ– */
        @media (max-width: 600px) {
            body { padding: 10px; }
            
            .calculator-grid { 
                grid-template-columns: 1fr;
                gap: 12px;
            }
            
            .card { padding: 12px; }
            
            .input-row { grid-template-columns: 1fr; gap: 10px; }
            
            .damage-results-grid { grid-template-columns: 1fr; gap: 12px; }
            
            .base-results { grid-template-columns: repeat(2, 1fr); }
            
            .modifier-section { grid-template-columns: 1fr 1fr; }
            
            .reform-table { 
                grid-template-columns: repeat(3, 1fr); 
                font-size: 0.75rem;
            }
            
            .damage-stat-value { font-size: 1rem; }
            
            .compare-list-table { font-size: 0.9rem; min-width: 800px; }
            .compare-list-table th { padding: 10px 6px; font-size: 0.85rem; }
            .compare-list-table td { padding: 10px 6px; }
            .compare-list-table .dmg-cell { font-size: 0.95rem; }
        }

        @media (max-width: 400px) {
            h1 { font-size: 1.3rem; margin-bottom: 15px; }
            .card-title { font-size: 1rem; }
            .base-result-value { font-size: 1rem; }
            .modifier-section { grid-template-columns: 1fr; }
        }

        /* å…¬å¼èªªæ˜å€ */
        .formula-toggle {
            background: transparent;
            border: 1px solid var(--accent-cyan);
            color: var(--accent-cyan);
            padding: 4px 10px;
            border-radius: 5px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .formula-toggle:hover {
            background: var(--accent-cyan);
            color: #000;
        }

        .formula-section {
            display: none;
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid var(--border-color);
            font-size: 0.85rem;
            line-height: 1.8;
        }

        .formula-section.show {
            display: block;
        }

        .formula-section h4 {
            color: var(--accent-cyan);
            margin-bottom: 12px;
            font-size: 0.95rem;
        }

        .formula-item {
            background: #fff;
            padding: 10px 12px;
            border-radius: 6px;
            margin-bottom: 10px;
            border-left: 3px solid var(--accent-blue);
            border: 1px solid var(--border-color);
            border-left: 3px solid var(--accent-blue);
        }

        .formula-item:last-child {
            margin-bottom: 0;
        }

        .formula-item.main {
            border-left-color: var(--accent-gold);
            background: linear-gradient(90deg, rgba(230, 126, 34, 0.1), #fff);
        }

        .formula-label {
            color: var(--accent-blue);
            font-weight: 600;
            display: block;
            margin-bottom: 5px;
        }

        .formula-item.main .formula-label {
            color: var(--accent-gold);
        }

        .formula-code {
            font-family: 'Consolas', 'Monaco', monospace;
            color: var(--text-primary);
            word-break: break-all;
        }

        .formula-note {
            color: var(--text-secondary);
            font-size: 0.8rem;
            margin-top: 5px;
            font-style: italic;
        }

        .formula-var {
            color: var(--accent-green);
        }

        .formula-op {
            color: var(--accent-orange);
        }

        @media (max-width: 600px) {
            .formula-section { font-size: 0.8rem; padding: 12px; }
            .formula-item { padding: 8px 10px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>âš”ï¸ å‚·å®³è¨ˆç®—æ©Ÿ âš”ï¸</h1>
        
        <div class="calculator-grid">
            <!-- åŸºæœ¬æ•¸å€¼ -->
            <div class="card">
                <div class="card-title">ğŸ“Š åŸºæœ¬æ•¸å€¼</div>
                <div class="input-row">
                    <div class="input-group">
                        <label>æ”»æ“ŠåŠ›</label>
                        <input type="number" id="attack" value="500" min="0" inputmode="numeric">
                    </div>
                    <div class="input-group">
                        <label>é˜²ç¦¦åŠ› (è¢«æ‰“æ–¹)</label>
                        <input type="number" id="defense" value="300" min="0" inputmode="numeric">
                    </div>
                </div>
                <div class="input-row">
                    <div class="input-group">
                        <label>æ”»æ“Šæ–¹ç­‰ç´š</label>
                        <input type="number" id="attackerLevel" value="100" min="1" inputmode="numeric">
                    </div>
                    <div class="input-group">
                        <label>é˜²ç¦¦æ–¹ç­‰ç´š</label>
                        <input type="number" id="defenderLevel" value="100" min="1" inputmode="numeric">
                    </div>
                </div>
            </div>

            <!-- æ­¦å™¨èˆ‡å±¬æ€§ -->
            <div class="card">
                <div class="card-title">ğŸ—¡ï¸ æ­¦å™¨èˆ‡å±¬æ€§</div>
                <div class="input-group">
                    <label>æ­¦å™¨éŠ³åˆ©åº¦</label>
                    <select id="weaponSharpness">
                        <option value="0">ç©ºæ‰‹ (+0%)</option>
                        <option value="0.15" selected>æœ‰æ­¦å™¨ (+15%)</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>æ°´æ™¶å±¬æ€§å½±éŸ¿</label>
                    <select id="crystalElement">
                        <option value="0.30" data-label="å…¨å‰‹">å…¨å‰‹ (+30%)</option>
                        <option value="0.15" data-label="åŠå‰‹">åŠå‰‹ (+15%)</option>
                        <option value="0" data-label="ä¸ç›¸å‰‹" selected>ä¸ç›¸å‰‹ (+0%)</option>
                        <option value="-0.15" data-label="è¢«åŠå‰‹">è¢«åŠå‰‹ (-15%)</option>
                        <option value="-0.30" data-label="è¢«å…¨å‰‹">è¢«å…¨å‰‹ (-30%)</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>ç¨®æ—å½±éŸ¿</label>
                    <select id="raceEffect">
                        <option value="0.20" data-label="å…¨å‰‹">å…¨å‰‹ (+20%)</option>
                        <option value="0.10" data-label="åŠå‰‹">åŠå‰‹ (+10%)</option>
                        <option value="0" data-label="ä¸ç›¸å‰‹" selected>ä¸ç›¸å‰‹ (+0%)</option>
                        <option value="-0.10" data-label="è¢«åŠå‰‹">è¢«åŠå‰‹ (-10%)</option>
                        <option value="-0.20" data-label="è¢«å…¨å‰‹">è¢«å…¨å‰‹ (-20%)</option>
                    </select>
                </div>
            </div>

            <!-- æŠ€èƒ½å€ç‡ -->
            <div class="card">
                <div class="card-title">âœ¨ æŠ€èƒ½å‚·å®³å€ç‡</div>
                <div class="input-group">
                    <label>æŠ€èƒ½å€ç‡ (45% ~ 220%)</label>
                    <div class="skill-input-row">
                        <input type="range" id="skillMultiplierRange" min="45" max="220" value="100">
                        <input type="number" id="skillMultiplierInput" min="45" max="220" value="100" inputmode="numeric">
                        <span class="percent-sign">%</span>
                    </div>
                </div>
            </div>

            <!-- å¯µç‰©åŠ ä¹˜ -->
            <div class="card">
                <div class="card-title">ğŸ¾ å¯µç‰©åŠ ä¹˜è¨­å®š</div>

                <div class="input-group">
                    <label>å¯µç‰©å¡ç‰‡ç­‰ç´š</label>
                    <select id="petGrade">
                        <option value="normal">æ™®å¡å¯µ</option>
                        <option value="silver">éŠ€å¡å¯µ</option>
                        <option value="gold" selected>é‡‘å¡å¯µ</option>
                    </select>
                </div>

                <div class="toggle-group">
                    <label class="toggle-switch">
                        <input type="checkbox" id="maxStats" checked>
                        <span class="toggle-slider"></span>
                    </label>
                    <span class="toggle-label">æ»¿æª”ç‹€æ…‹</span>
                </div>

                <div class="toggle-group">
                    <label class="toggle-switch">
                        <input type="checkbox" id="beastPassive">
                        <span class="toggle-slider"></span>
                    </label>
                    <span class="toggle-label">é‡ç¸ç³»è¢«å‹•</span>
                </div>

                <div class="input-group">
                    <label>å¯µç‰©æ”¹é€ ç­‰ç´š (BOSSæˆ°ç”¨)</label>
                    <select id="petReform">
                        <option value="0">æœªæ”¹é€ </option>
                        <option value="1">ä¸€æ”¹</option>
                        <option value="2">äºŒæ”¹</option>
                        <option value="3">ä¸‰æ”¹</option>
                        <option value="4">å››æ”¹</option>
                        <option value="5">äº”æ”¹</option>
                    </select>
                </div>
            </div>

            <!-- è¨ˆç®—æŒ‰éˆ• -->
            <div class="card" style="display: flex; flex-direction: column; justify-content: center;">
                <div class="input-group">
                    <label>è¨˜éŒ„åç¨± (åŠ å…¥æ¸…å–®ç”¨)</label>
                    <input type="text" id="recordName" placeholder="ä¾‹å¦‚ï¼šé‡‘å¯µäº”æ”¹æ»¿æª”">
                </div>
                <button class="btn-calculate" onclick="calculate()">ğŸ”¥ è¨ˆç®—å‚·å®³ ğŸ”¥</button>
                <button class="btn-add-compare" onclick="addToCompareList()">ğŸ“‹ åŠ å…¥æ¯”è¼ƒæ¸…å–®</button>
            </div>

            <!-- çµæœé¡¯ç¤º -->
            <div class="results-section">
                <div class="card results-card">
                    <div class="card-title">
                        <span>ğŸ“ˆ è¨ˆç®—çµæœ</span>
                        <button class="formula-toggle" onclick="toggleFormula()">ğŸ“ æŸ¥çœ‹å…¬å¼</button>
                    </div>

                    <!-- å…¬å¼èªªæ˜å€ -->
                    <div class="formula-section" id="formulaSection">
                        <h4>ğŸ“ å‚·å®³è¨ˆç®—å…¬å¼èªªæ˜</h4>
                        
                        <div class="formula-item">
                            <span class="formula-label">â‘  æ”»æ“Šå¯¦éš›æ•ˆæ‡‰å€¼</span>
                            <span class="formula-code">
                                <span class="formula-var">æ”»æ“Šæ•ˆæ‡‰</span> <span class="formula-op">=</span> <span class="formula-var">æ”»æ“ŠåŠ›</span>ï¼ˆè‹¥ â‰¤ 240ï¼‰<span class="formula-op">æˆ–</span> 240 <span class="formula-op">+</span> 0.3 <span class="formula-op">Ã—</span> (<span class="formula-var">æ”»æ“ŠåŠ›</span> <span class="formula-op">-</span> 240)ï¼ˆè‹¥ > 240ï¼‰
                            </span>
                        </div>

                        <div class="formula-item">
                            <span class="formula-label">â‘¡ é˜²ç¦¦å¯¦éš›æ•ˆæ‡‰å€¼</span>
                            <span class="formula-code">
                                <span class="formula-var">é˜²ç¦¦æ•ˆæ‡‰</span> <span class="formula-op">=</span> <span class="formula-var">é˜²ç¦¦åŠ›</span>ï¼ˆè‹¥ â‰¤ 240ï¼‰<span class="formula-op">æˆ–</span> 240 <span class="formula-op">+</span> 0.3 <span class="formula-op">Ã—</span> (<span class="formula-var">é˜²ç¦¦åŠ›</span> <span class="formula-op">-</span> 240)ï¼ˆè‹¥ > 240ï¼‰
                            </span>
                        </div>

                        <div class="formula-item">
                            <span class="formula-label">â‘¢ åŸºæœ¬å‚·å®³å€¼</span>
                            <span class="formula-code">
                                <span class="formula-var">åŸºæœ¬å‚·å®³</span> <span class="formula-op">=</span> <span class="formula-var">æ”»æ“Šæ•ˆæ‡‰</span>Â² <span class="formula-op">Ã—</span> 3 <span class="formula-op">Ã·</span> (<span class="formula-var">æ”»æ“Šæ•ˆæ‡‰</span> <span class="formula-op">+</span> <span class="formula-var">é˜²ç¦¦æ•ˆæ‡‰</span> <span class="formula-op">Ã—</span> 3)
                            </span>
                        </div>

                        <div class="formula-item">
                            <span class="formula-label">â‘£ å¿…æ®ºä¿®æ­£å€¼</span>
                            <span class="formula-code">
                                <span class="formula-var">å¿…æ®ºä¿®æ­£</span> <span class="formula-op">=</span> <span class="formula-var">è¢«æ‰“é˜²ç¦¦åŠ›</span> <span class="formula-op">Ã—</span> <span class="formula-var">æ”»æ“Šæ–¹ç­‰ç´š</span> <span class="formula-op">Ã·</span> (<span class="formula-var">é˜²ç¦¦æ–¹ç­‰ç´š</span> <span class="formula-op">Ã—</span> 2)
                            </span>
                            <div class="formula-note">â€» ç„¡å¿…æ®ºæ™‚æ­¤å€¼ç‚º 0</div>
                        </div>

                        <div class="formula-item main">
                            <span class="formula-label">â‘¤ å¯¦éš›å‚·å®³å€¼ï¼ˆå®Œæ•´å…¬å¼ï¼‰</span>
                            <span class="formula-code">
                                <span class="formula-var">å¯¦éš›å‚·å®³</span> <span class="formula-op">=</span> [<span class="formula-var">åŸºæœ¬å‚·å®³</span> <span class="formula-op">Ã—</span> <span class="formula-var">æ­¦å™¨ä¿®æ­£</span> <span class="formula-op">Ã—</span> <span class="formula-var">æ°´æ™¶å±¬æ€§</span> <span class="formula-op">Ã—</span> <span class="formula-var">éš¨æ©Ÿå€¼(90%~110%)</span> <span class="formula-op">+</span> <span class="formula-var">å¿…æ®ºä¿®æ­£</span>] <span class="formula-op">Ã—</span> <span class="formula-var">ç¨®æ—å½±éŸ¿</span> <span class="formula-op">Ã—</span> <span class="formula-var">æŠ€èƒ½å€ç‡</span> <span class="formula-op">Ã—</span> <span class="formula-var">æ»¿æª”åŠ ä¹˜</span> <span class="formula-op">Ã—</span> <span class="formula-var">æ”¹é€ BOSSå¢å‚·</span> <span class="formula-op">Ã—</span> <span class="formula-var">é‡ç¸è¢«å‹•</span>
                            </span>
                            <div class="formula-note">
                                â€» æ­¦å™¨ä¿®æ­£ï¼šç©ºæ‰‹=1.0ï¼Œæœ‰æ­¦å™¨=1.15<br>
                                â€» æ°´æ™¶å±¬æ€§ï¼šå…¨å‰‹=1.3ï¼ŒåŠå‰‹=1.15ï¼Œä¸ç›¸å‰‹=1.0ï¼Œè¢«åŠå‰‹=0.85ï¼Œè¢«å…¨å‰‹=0.7<br>
                                â€» ç¨®æ—å½±éŸ¿ï¼šå…¨å‰‹=1.2ï¼ŒåŠå‰‹=1.1ï¼Œä¸ç›¸å‰‹=1.0ï¼Œè¢«åŠå‰‹=0.9ï¼Œè¢«å…¨å‰‹=0.8<br>
                                â€» æ”¹é€ BOSSå¢å‚·ï¼šåƒ…åœ¨BOSSæˆ°æ™‚ç”Ÿæ•ˆ
                            </div>
                        </div>
                    </div>
                    
                    <!-- åŸºç¤è¨ˆç®—æ•¸å€¼ -->
                    <div class="base-results">
                        <div class="base-result-item">
                            <div class="base-result-label">æ”»æ“Šå¯¦éš›æ•ˆæ‡‰å€¼</div>
                            <div class="base-result-value" id="resultAttackEffect">-</div>
                        </div>
                        <div class="base-result-item">
                            <div class="base-result-label">é˜²ç¦¦å¯¦éš›æ•ˆæ‡‰å€¼</div>
                            <div class="base-result-value" id="resultDefenseEffect">-</div>
                        </div>
                        <div class="base-result-item">
                            <div class="base-result-label">åŸºæœ¬å‚·å®³å€¼</div>
                            <div class="base-result-value gold" id="resultBaseDamage">-</div>
                        </div>
                        <div class="base-result-item">
                            <div class="base-result-label">å¿…æ®ºä¿®æ­£å€¼</div>
                            <div class="base-result-value orange" id="resultCritCorrection">-</div>
                        </div>
                    </div>

                    <!-- å„é …ä¿®æ­£å€¼ -->
                    <div class="modifier-section">
                        <div class="modifier-item">
                            <span class="modifier-label">ğŸ’ æ°´æ™¶å±¬æ€§</span>
                            <span class="modifier-value" id="modCrystal">-</span>
                        </div>
                        <div class="modifier-item">
                            <span class="modifier-label">ğŸ‘¾ ç¨®æ—å½±éŸ¿</span>
                            <span class="modifier-value" id="modRace">-</span>
                        </div>
                        <div class="modifier-item">
                            <span class="modifier-label">âš”ï¸ æ­¦å™¨éŠ³åˆ©åº¦</span>
                            <span class="modifier-value" id="modWeapon">-</span>
                        </div>
                        <div class="modifier-item">
                            <span class="modifier-label">âœ¨ æŠ€èƒ½å€ç‡</span>
                            <span class="modifier-value" id="modSkill">-</span>
                        </div>
                        <div class="modifier-item">
                            <span class="modifier-label">ğŸ“Š æ»¿æª”åŠ ä¹˜</span>
                            <span class="modifier-value" id="modMaxStats">-</span>
                        </div>
                        <div class="modifier-item">
                            <span class="modifier-label">ğŸº é‡ç¸è¢«å‹•</span>
                            <span class="modifier-value" id="modBeast">-</span>
                        </div>
                    </div>

                    <!-- æ”¹é€ å€ç‡è¡¨ -->
                    <div class="reform-table-section">
                        <div class="reform-table-title">ğŸ”§ æ”¹é€ BOSSå¢å‚·å€ç‡ (ç•¶å‰å¡åˆ¥: <span id="currentGrade">é‡‘å¡</span>)</div>
                        <div class="reform-table" id="reformTable">
                            <!-- å‹•æ…‹ç”Ÿæˆ -->
                        </div>
                    </div>

                    <!-- å‚·å®³çµæœåˆ†é¡ -->
                    <div class="damage-category">
                        <h4 class="damage-category-title">ğŸ—¡ï¸ ä¸€èˆ¬å‚·å®³ï¼ˆç„¡BOSSå¢å‚·ï¼‰</h4>
                        <div class="damage-results-grid">
                            <!-- æ™®æ”»å‚·å®³ (100%, ç„¡å¿…æ®º) -->
                            <div class="damage-box normal-atk">
                                <div class="damage-box-title">
                                    <span class="tag tag-normal">æ™®æ”»100%</span>
                                    <span class="tag tag-no-crit">ç„¡å¿…æ®º</span>
                                </div>
                                <div class="damage-values">
                                    <div class="damage-stat min">
                                        <div class="damage-stat-label">æœ€å°</div>
                                        <div class="damage-stat-value" id="dmgNA_NoCrit_Min">-</div>
                                    </div>
                                    <div class="damage-stat avg">
                                        <div class="damage-stat-label">å¹³å‡</div>
                                        <div class="damage-stat-value" id="dmgNA_NoCrit_Avg">-</div>
                                    </div>
                                    <div class="damage-stat max">
                                        <div class="damage-stat-label">æœ€å¤§</div>
                                        <div class="damage-stat-value" id="dmgNA_NoCrit_Max">-</div>
                                    </div>
                                </div>
                            </div>

                            <!-- æŠ€èƒ½å‚·å®³ (æŠ€èƒ½%, ç„¡å¿…æ®º) -->
                            <div class="damage-box no-crit">
                                <div class="damage-box-title">
                                    <span class="tag tag-skill" id="tagSkill1">æŠ€èƒ½%</span>
                                    <span class="tag tag-no-crit">ç„¡å¿…æ®º</span>
                                </div>
                                <div class="damage-values">
                                    <div class="damage-stat min">
                                        <div class="damage-stat-label">æœ€å°</div>
                                        <div class="damage-stat-value" id="dmgSkill_NoCrit_Min">-</div>
                                    </div>
                                    <div class="damage-stat avg">
                                        <div class="damage-stat-label">å¹³å‡</div>
                                        <div class="damage-stat-value" id="dmgSkill_NoCrit_Avg">-</div>
                                    </div>
                                    <div class="damage-stat max">
                                        <div class="damage-stat-label">æœ€å¤§</div>
                                        <div class="damage-stat-value" id="dmgSkill_NoCrit_Max">-</div>
                                    </div>
                                </div>
                            </div>

                            <!-- æ™®æ”»å¿…æ®º (100%, æœ‰å¿…æ®º) -->
                            <div class="damage-box with-crit">
                                <div class="damage-box-title">
                                    <span class="tag tag-normal">æ™®æ”»100%</span>
                                    <span class="tag tag-crit">æœ‰å¿…æ®º</span>
                                </div>
                                <div class="damage-values">
                                    <div class="damage-stat min">
                                        <div class="damage-stat-label">æœ€å°</div>
                                        <div class="damage-stat-value" id="dmgNA_Crit_Min">-</div>
                                    </div>
                                    <div class="damage-stat avg">
                                        <div class="damage-stat-label">å¹³å‡</div>
                                        <div class="damage-stat-value" id="dmgNA_Crit_Avg">-</div>
                                    </div>
                                    <div class="damage-stat max">
                                        <div class="damage-stat-label">æœ€å¤§</div>
                                        <div class="damage-stat-value" id="dmgNA_Crit_Max">-</div>
                                    </div>
                                </div>
                            </div>

                            <!-- æŠ€èƒ½å¿…æ®º (æŠ€èƒ½%, æœ‰å¿…æ®º) -->
                            <div class="damage-box with-crit">
                                <div class="damage-box-title">
                                    <span class="tag tag-skill" id="tagSkill2">æŠ€èƒ½%</span>
                                    <span class="tag tag-crit">æœ‰å¿…æ®º</span>
                                </div>
                                <div class="damage-values">
                                    <div class="damage-stat min">
                                        <div class="damage-stat-label">æœ€å°</div>
                                        <div class="damage-stat-value" id="dmgSkill_Crit_Min">-</div>
                                    </div>
                                    <div class="damage-stat avg">
                                        <div class="damage-stat-label">å¹³å‡</div>
                                        <div class="damage-stat-value" id="dmgSkill_Crit_Avg">-</div>
                                    </div>
                                    <div class="damage-stat max">
                                        <div class="damage-stat-label">æœ€å¤§</div>
                                        <div class="damage-stat-value" id="dmgSkill_Crit_Max">-</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="damage-category">
                        <h4 class="damage-category-title">ğŸ‘¹ BOSSæˆ°å‚·å®³ï¼ˆå«æ”¹é€ å¢å‚·ï¼‰</h4>
                        <div class="damage-results-grid">
                            <!-- æ™®æ”»BOSS (100%, ç„¡å¿…æ®º) -->
                            <div class="damage-box with-boss">
                                <div class="damage-box-title">
                                    <span class="tag tag-normal">æ™®æ”»100%</span>
                                    <span class="tag tag-no-crit">ç„¡å¿…æ®º</span>
                                </div>
                                <div class="damage-values">
                                    <div class="damage-stat min">
                                        <div class="damage-stat-label">æœ€å°</div>
                                        <div class="damage-stat-value" id="dmgNA_Boss_Min">-</div>
                                    </div>
                                    <div class="damage-stat avg">
                                        <div class="damage-stat-label">å¹³å‡</div>
                                        <div class="damage-stat-value" id="dmgNA_Boss_Avg">-</div>
                                    </div>
                                    <div class="damage-stat max">
                                        <div class="damage-stat-label">æœ€å¤§</div>
                                        <div class="damage-stat-value" id="dmgNA_Boss_Max">-</div>
                                    </div>
                                </div>
                            </div>

                            <!-- æŠ€èƒ½BOSS (æŠ€èƒ½%, ç„¡å¿…æ®º) -->
                            <div class="damage-box with-boss">
                                <div class="damage-box-title">
                                    <span class="tag tag-skill" id="tagSkill3">æŠ€èƒ½%</span>
                                    <span class="tag tag-no-crit">ç„¡å¿…æ®º</span>
                                </div>
                                <div class="damage-values">
                                    <div class="damage-stat min">
                                        <div class="damage-stat-label">æœ€å°</div>
                                        <div class="damage-stat-value" id="dmgSkill_Boss_Min">-</div>
                                    </div>
                                    <div class="damage-stat avg">
                                        <div class="damage-stat-label">å¹³å‡</div>
                                        <div class="damage-stat-value" id="dmgSkill_Boss_Avg">-</div>
                                    </div>
                                    <div class="damage-stat max">
                                        <div class="damage-stat-label">æœ€å¤§</div>
                                        <div class="damage-stat-value" id="dmgSkill_Boss_Max">-</div>
                                    </div>
                                </div>
                            </div>

                            <!-- æ™®æ”»BOSSå¿…æ®º (100%, æœ‰å¿…æ®º) -->
                            <div class="damage-box highlight">
                                <div class="damage-box-title">
                                    <span class="tag tag-normal">æ™®æ”»100%</span>
                                    <span class="tag tag-crit">æœ‰å¿…æ®º</span>
                                </div>
                                <div class="damage-values">
                                    <div class="damage-stat min">
                                        <div class="damage-stat-label">æœ€å°</div>
                                        <div class="damage-stat-value" id="dmgNA_BossCrit_Min">-</div>
                                    </div>
                                    <div class="damage-stat avg">
                                        <div class="damage-stat-label">å¹³å‡</div>
                                        <div class="damage-stat-value" id="dmgNA_BossCrit_Avg">-</div>
                                    </div>
                                    <div class="damage-stat max">
                                        <div class="damage-stat-label">æœ€å¤§</div>
                                        <div class="damage-stat-value" id="dmgNA_BossCrit_Max">-</div>
                                    </div>
                                </div>
                            </div>

                            <!-- æŠ€èƒ½BOSSå¿…æ®º (æŠ€èƒ½%, æœ‰å¿…æ®º) - æœ€å¤§è¼¸å‡º -->
                            <div class="damage-box highlight">
                                <div class="damage-box-title">
                                    <span class="tag tag-skill" id="tagSkill4">æŠ€èƒ½%</span>
                                    <span class="tag tag-crit">æœ‰å¿…æ®º</span>
                                    ğŸ”¥
                                </div>
                                <div class="damage-values">
                                    <div class="damage-stat min">
                                        <div class="damage-stat-label">æœ€å°</div>
                                        <div class="damage-stat-value" id="dmgSkill_BossCrit_Min">-</div>
                                    </div>
                                    <div class="damage-stat avg">
                                        <div class="damage-stat-label">å¹³å‡</div>
                                        <div class="damage-stat-value" id="dmgSkill_BossCrit_Avg">-</div>
                                    </div>
                                    <div class="damage-stat max">
                                        <div class="damage-stat-label">æœ€å¤§</div>
                                        <div class="damage-stat-value" id="dmgSkill_BossCrit_Max">-</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- æ¯”è¼ƒæ¸…å–® -->
            <div class="results-section">
                <div class="card compare-list-card">
                    <div class="card-title">
                        <span>ğŸ“‹ æ¯”è¼ƒæ¸…å–®</span>
                        <button class="btn-clear-list" onclick="clearCompareList()">æ¸…ç©ºæ¸…å–®</button>
                    </div>
                    
                    <div id="compareListContent">
                        <div class="compare-list-empty" id="compareListEmpty">
                            <div class="icon">ğŸ“</div>
                            <p>å°šç„¡æ¯”è¼ƒè¨˜éŒ„</p>
                            <p style="font-size: 0.9rem; margin-top: 5px;">è¨ˆç®—å¾Œé»æ“Šã€ŒåŠ å…¥æ¯”è¼ƒæ¸…å–®ã€ä¾†æ–°å¢è¨˜éŒ„</p>
                        </div>
                        
                        <div class="compare-list-scroll" id="compareListScroll" style="display: none;">
                            <table class="compare-list-table">
                                <thead>
                                    <tr>
                                        <th rowspan="2">åç¨±</th>
                                        <th rowspan="2">æ”»/é˜²</th>
                                        <th rowspan="2">æ­¦å™¨</th>
                                        <th rowspan="2">å±¬æ€§</th>
                                        <th rowspan="2">ç¨®æ—</th>
                                        <th rowspan="2">å¡åˆ¥</th>
                                        <th rowspan="2">æ»¿æª”</th>
                                        <th rowspan="2">é‡ç¸</th>
                                        <th rowspan="2">æ”¹é€ </th>
                                        <th rowspan="2">æŠ€èƒ½%</th>
                                        <th colspan="2">ä¸€èˆ¬å‚·å®³</th>
                                        <th colspan="2">å¿…æ®ºå‚·å®³</th>
                                        <th colspan="2">BOSSå‚·</th>
                                        <th colspan="2">BOSSå¿…æ®º</th>
                                        <th rowspan="2">æ“ä½œ</th>
                                    </tr>
                                    <tr>
                                        <th>æ™®æ”»</th>
                                        <th>æŠ€èƒ½</th>
                                        <th>æ™®æ”»</th>
                                        <th>æŠ€èƒ½</th>
                                        <th>æ™®æ”»</th>
                                        <th>æŠ€èƒ½</th>
                                        <th>æ™®æ”»</th>
                                        <th>æŠ€èƒ½</th>
                                    </tr>
                                </thead>
                                <tbody id="compareListBody">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // è³‡æ–™è¡¨
        const maxStatsBonusTable = { normal: 0.10, silver: 0.15, gold: 0.20 };
        const petReformBonusTable = {
            0: { normal: 0, silver: 0, gold: 0 },
            1: { normal: 0.06, silver: 0.09, gold: 0.13 },
            2: { normal: 0.09, silver: 0.13, gold: 0.18 },
            3: { normal: 0.12, silver: 0.17, gold: 0.23 },
            4: { normal: 0.16, silver: 0.22, gold: 0.29 },
            5: { normal: 0.20, silver: 0.27, gold: 0.35 }
        };
        const beastPassiveBonusTable = { normal: 0.03, silver: 0.05, gold: 0.08 };
        const gradeNames = { normal: 'æ™®å¡', silver: 'éŠ€å¡', gold: 'é‡‘å¡' };
        const reformLabels = ['æœªæ”¹', 'ä¸€æ”¹', 'äºŒæ”¹', 'ä¸‰æ”¹', 'å››æ”¹', 'äº”æ”¹'];

        let compareList = [];
        let recordCounter = 1;
        let baseItemId = null; // åŸºæº–é …ç›® ID

        // å…¬å¼å€å¡Šåˆ‡æ›
        function toggleFormula() {
            const section = document.getElementById('formulaSection');
            const btn = document.querySelector('.formula-toggle');
            section.classList.toggle('show');
            btn.textContent = section.classList.contains('show') ? 'ğŸ“ éš±è—å…¬å¼' : 'ğŸ“ æŸ¥çœ‹å…¬å¼';
        }

        // æŠ€èƒ½å€ç‡åŒæ­¥
        const skillRange = document.getElementById('skillMultiplierRange');
        const skillInput = document.getElementById('skillMultiplierInput');

        skillRange.addEventListener('input', function() {
            skillInput.value = this.value;
            calculate();
        });

        skillInput.addEventListener('input', function() {
            // è¼¸å…¥æ™‚ä¸å¼·åˆ¶é™åˆ¶ï¼Œè®“ä½¿ç”¨è€…å¯ä»¥è‡ªç”±è¼¸å…¥
            const val = parseInt(this.value);
            if (!isNaN(val) && val >= 45 && val <= 220) {
                skillRange.value = val;
                calculate();
            }
        });

        skillInput.addEventListener('blur', function() {
            // å¤±å»ç„¦é»æ™‚æ‰é©—è­‰ä¸¦ä¿®æ­£æ•¸å€¼
            let val = parseInt(this.value);
            if (isNaN(val) || val < 45) val = 45;
            if (val > 220) val = 220;
            this.value = val;
            skillRange.value = val;
            calculate();
        });

        skillInput.addEventListener('keydown', function(e) {
            // æŒ‰ Enter æ™‚é©—è­‰ä¸¦æ›´æ–°
            if (e.key === 'Enter') {
                this.blur();
            }
        });

        function formatModifier(value, isPercent = true) {
            if (value === 0) return '<span class="modifier-neutral">+0%</span>';
            const sign = value > 0 ? '+' : '';
            const cls = value > 0 ? 'modifier-positive' : 'modifier-negative';
            const display = isPercent ? `${sign}${(value * 100).toFixed(0)}%` : `Ã—${value.toFixed(2)}`;
            return `<span class="${cls}">${display}</span>`;
        }

        function getSelectedLabel(selectId) {
            const sel = document.getElementById(selectId);
            return sel.options[sel.selectedIndex].getAttribute('data-label') || '';
        }

        function renderReformTable(petGrade, currentReform) {
            const tableEl = document.getElementById('reformTable');
            document.getElementById('currentGrade').textContent = gradeNames[petGrade];
            document.getElementById('currentGrade').className = `grade-${petGrade}`;

            let html = '';
            // Header
            for (let i = 0; i <= 5; i++) {
                html += `<div class="reform-table-cell header">${reformLabels[i]}</div>`;
            }
            // Values
            for (let i = 0; i <= 5; i++) {
                const bonus = petReformBonusTable[i][petGrade];
                const isActive = i === currentReform;
                const displayVal = bonus === 0 ? '-' : `+${(bonus * 100).toFixed(0)}%`;
                html += `<div class="reform-table-cell${isActive ? ' active' : ''}">${displayVal}</div>`;
            }
            tableEl.innerHTML = html;
        }

        function getCurrentParams() {
            const attack = parseFloat(document.getElementById('attack').value) || 0;
            const defense = parseFloat(document.getElementById('defense').value) || 0;
            const attackerLevel = parseFloat(document.getElementById('attackerLevel').value) || 1;
            const defenderLevel = parseFloat(document.getElementById('defenderLevel').value) || 1;
            const weaponSharpness = parseFloat(document.getElementById('weaponSharpness').value);
            const crystalElement = parseFloat(document.getElementById('crystalElement').value);
            const raceEffect = parseFloat(document.getElementById('raceEffect').value);
            const skillMultiplier = parseFloat(skillInput.value) / 100;
            const isMaxStats = document.getElementById('maxStats').checked;
            const petReformLevel = parseInt(document.getElementById('petReform').value);
            const isBeast = document.getElementById('beastPassive').checked;
            const petGrade = document.getElementById('petGrade').value;

            const crystalLabel = getSelectedLabel('crystalElement');
            const raceLabel = getSelectedLabel('raceEffect');

            const attackEffect = attack <= 240 ? attack : 240 + 0.3 * (attack - 240);
            const defenseEffect = defense <= 240 ? defense : 240 + 0.3 * (defense - 240);
            const baseDamage = Math.pow(attackEffect, 2) * 3 / (attackEffect + defenseEffect * 3);
            const critCorrection = defense * attackerLevel / (defenderLevel * 2);
            const weaponModifier = 1 + weaponSharpness;
            const crystalModifier = 1 + crystalElement;
            const raceModifier = 1 + raceEffect;

            const maxStatsBonus = isMaxStats ? maxStatsBonusTable[petGrade] : 0;
            const petReformBonus = petReformBonusTable[petReformLevel][petGrade];
            const beastBonus = isBeast ? beastPassiveBonusTable[petGrade] : 0;

            return {
                attack, defense, attackerLevel, defenderLevel,
                weaponSharpness, crystalElement, raceEffect,
                crystalLabel, raceLabel,
                skillMultiplier, isMaxStats, petReformLevel, isBeast, petGrade,
                attackEffect, defenseEffect, baseDamage, critCorrection,
                weaponModifier, crystalModifier, raceModifier,
                maxStatsBonus, petReformBonus, beastBonus
            };
        }

        function calculateDamage(params, withCrit, withBoss, skillMult = null) {
            const { baseDamage, critCorrection, weaponModifier, crystalModifier, raceModifier, 
                    skillMultiplier, maxStatsBonus, petReformBonus, beastBonus } = params;

            const actualSkillMult = skillMult !== null ? skillMult : skillMultiplier;
            const maxStatsMult = 1 + maxStatsBonus;
            const beastMult = 1 + beastBonus;
            const reformMult = withBoss ? (1 + petReformBonus) : 1;
            const crit = withCrit ? critCorrection : 0;

            const baseCalc = baseDamage * weaponModifier * crystalModifier;
            
            const dmgMin = (baseCalc * 0.90 + crit) * raceModifier * actualSkillMult * maxStatsMult * reformMult * beastMult;
            const dmgAvg = (baseCalc * 1.00 + crit) * raceModifier * actualSkillMult * maxStatsMult * reformMult * beastMult;
            const dmgMax = (baseCalc * 1.10 + crit) * raceModifier * actualSkillMult * maxStatsMult * reformMult * beastMult;

            return {
                min: Math.floor(dmgMin),
                avg: Math.floor(dmgAvg),
                max: Math.floor(dmgMax)
            };
        }

        function calculate() {
            const params = getCurrentParams();

            // åŸºç¤æ•¸å€¼
            document.getElementById('resultAttackEffect').textContent = params.attackEffect.toFixed(2);
            document.getElementById('resultDefenseEffect').textContent = params.defenseEffect.toFixed(2);
            document.getElementById('resultBaseDamage').textContent = params.baseDamage.toFixed(2);
            document.getElementById('resultCritCorrection').textContent = params.critCorrection.toFixed(2);

            // ä¿®æ­£å€¼
            document.getElementById('modCrystal').innerHTML = 
                `${params.crystalLabel} ${formatModifier(params.crystalElement)}`;
            document.getElementById('modRace').innerHTML = 
                `${params.raceLabel} ${formatModifier(params.raceEffect)}`;
            document.getElementById('modWeapon').innerHTML = formatModifier(params.weaponSharpness);
            document.getElementById('modSkill').innerHTML = 
                `<span class="modifier-positive">Ã—${params.skillMultiplier.toFixed(2)}</span>`;
            document.getElementById('modMaxStats').innerHTML = 
                params.isMaxStats ? formatModifier(params.maxStatsBonus) : '<span class="modifier-neutral">ç„¡</span>';
            document.getElementById('modBeast').innerHTML = 
                params.isBeast ? formatModifier(params.beastBonus) : '<span class="modifier-neutral">ç„¡</span>';

            // æ”¹é€ å€ç‡è¡¨
            renderReformTable(params.petGrade, params.petReformLevel);

            // æ›´æ–°æŠ€èƒ½%æ¨™ç±¤
            const skillPercent = Math.round(params.skillMultiplier * 100);
            document.getElementById('tagSkill1').textContent = `æŠ€èƒ½${skillPercent}%`;
            document.getElementById('tagSkill2').textContent = `æŠ€èƒ½${skillPercent}%`;
            document.getElementById('tagSkill3').textContent = `æŠ€èƒ½${skillPercent}%`;
            document.getElementById('tagSkill4').textContent = `æŠ€èƒ½${skillPercent}%`;

            // å…«ç¨®å‚·å®³æƒ…æ³
            // ä¸€èˆ¬å‚·å®³ï¼ˆç„¡BOSSå¢å‚·ï¼‰
            const dmgNA_NoCrit = calculateDamage(params, false, false, 1.0);    // æ™®æ”»100%, ç„¡å¿…æ®º
            const dmgSkill_NoCrit = calculateDamage(params, false, false);      // æŠ€èƒ½%, ç„¡å¿…æ®º
            const dmgNA_Crit = calculateDamage(params, true, false, 1.0);       // æ™®æ”»100%, æœ‰å¿…æ®º
            const dmgSkill_Crit = calculateDamage(params, true, false);         // æŠ€èƒ½%, æœ‰å¿…æ®º

            // BOSSæˆ°å‚·å®³ï¼ˆå«æ”¹é€ å¢å‚·ï¼‰
            const dmgNA_Boss = calculateDamage(params, false, true, 1.0);       // æ™®æ”»100%, ç„¡å¿…æ®º, BOSS
            const dmgSkill_Boss = calculateDamage(params, false, true);         // æŠ€èƒ½%, ç„¡å¿…æ®º, BOSS
            const dmgNA_BossCrit = calculateDamage(params, true, true, 1.0);    // æ™®æ”»100%, æœ‰å¿…æ®º, BOSS
            const dmgSkill_BossCrit = calculateDamage(params, true, true);      // æŠ€èƒ½%, æœ‰å¿…æ®º, BOSS

            // æ›´æ–°ä¸€èˆ¬å‚·å®³å€
            document.getElementById('dmgNA_NoCrit_Min').textContent = dmgNA_NoCrit.min.toLocaleString();
            document.getElementById('dmgNA_NoCrit_Avg').textContent = dmgNA_NoCrit.avg.toLocaleString();
            document.getElementById('dmgNA_NoCrit_Max').textContent = dmgNA_NoCrit.max.toLocaleString();

            document.getElementById('dmgSkill_NoCrit_Min').textContent = dmgSkill_NoCrit.min.toLocaleString();
            document.getElementById('dmgSkill_NoCrit_Avg').textContent = dmgSkill_NoCrit.avg.toLocaleString();
            document.getElementById('dmgSkill_NoCrit_Max').textContent = dmgSkill_NoCrit.max.toLocaleString();

            document.getElementById('dmgNA_Crit_Min').textContent = dmgNA_Crit.min.toLocaleString();
            document.getElementById('dmgNA_Crit_Avg').textContent = dmgNA_Crit.avg.toLocaleString();
            document.getElementById('dmgNA_Crit_Max').textContent = dmgNA_Crit.max.toLocaleString();

            document.getElementById('dmgSkill_Crit_Min').textContent = dmgSkill_Crit.min.toLocaleString();
            document.getElementById('dmgSkill_Crit_Avg').textContent = dmgSkill_Crit.avg.toLocaleString();
            document.getElementById('dmgSkill_Crit_Max').textContent = dmgSkill_Crit.max.toLocaleString();

            // æ›´æ–°BOSSå‚·å®³å€
            document.getElementById('dmgNA_Boss_Min').textContent = dmgNA_Boss.min.toLocaleString();
            document.getElementById('dmgNA_Boss_Avg').textContent = dmgNA_Boss.avg.toLocaleString();
            document.getElementById('dmgNA_Boss_Max').textContent = dmgNA_Boss.max.toLocaleString();

            document.getElementById('dmgSkill_Boss_Min').textContent = dmgSkill_Boss.min.toLocaleString();
            document.getElementById('dmgSkill_Boss_Avg').textContent = dmgSkill_Boss.avg.toLocaleString();
            document.getElementById('dmgSkill_Boss_Max').textContent = dmgSkill_Boss.max.toLocaleString();

            document.getElementById('dmgNA_BossCrit_Min').textContent = dmgNA_BossCrit.min.toLocaleString();
            document.getElementById('dmgNA_BossCrit_Avg').textContent = dmgNA_BossCrit.avg.toLocaleString();
            document.getElementById('dmgNA_BossCrit_Max').textContent = dmgNA_BossCrit.max.toLocaleString();

            document.getElementById('dmgSkill_BossCrit_Min').textContent = dmgSkill_BossCrit.min.toLocaleString();
            document.getElementById('dmgSkill_BossCrit_Avg').textContent = dmgSkill_BossCrit.avg.toLocaleString();
            document.getElementById('dmgSkill_BossCrit_Max').textContent = dmgSkill_BossCrit.max.toLocaleString();
        }

        function addToCompareList() {
            const params = getCurrentParams();
            let recordName = document.getElementById('recordName').value.trim();
            
            if (!recordName) {
                recordName = `è¨˜éŒ„ ${recordCounter++}`;
            }

            // æ™®æ”»ç‰ˆæœ¬ (100%)
            const dmgNA_NoCrit = calculateDamage(params, false, false, 1.0);
            const dmgNA_Crit = calculateDamage(params, true, false, 1.0);
            const dmgNA_Boss = calculateDamage(params, false, true, 1.0);
            const dmgNA_BossCrit = calculateDamage(params, true, true, 1.0);
            
            // æŠ€èƒ½ç‰ˆæœ¬
            const dmgSkill_NoCrit = calculateDamage(params, false, false);
            const dmgSkill_Crit = calculateDamage(params, true, false);
            const dmgSkill_Boss = calculateDamage(params, false, true);
            const dmgSkill_BossCrit = calculateDamage(params, true, true);

            compareList.push({
                id: Date.now(),
                name: recordName,
                attack: params.attack,
                defense: params.defense,
                hasWeapon: params.weaponSharpness > 0,
                petGrade: params.petGrade,
                isMaxStats: params.isMaxStats,
                isBeast: params.isBeast,
                petReformLevel: params.petReformLevel,
                crystalLabel: params.crystalLabel,
                raceLabel: params.raceLabel,
                skillPercent: Math.round(params.skillMultiplier * 100),
                maxStatsPercent: params.isMaxStats ? Math.round(params.maxStatsBonus * 100) : 0,
                reformPercent: Math.round(params.petReformBonus * 100),
                beastPercent: params.isBeast ? Math.round(params.beastBonus * 100) : 0,
                // æ™®æ”»ç‰ˆæœ¬
                dmgNA_NoCrit: dmgNA_NoCrit.avg,
                dmgNA_Crit: dmgNA_Crit.avg,
                dmgNA_Boss: dmgNA_Boss.avg,
                dmgNA_BossCrit: dmgNA_BossCrit.avg,
                // æŠ€èƒ½ç‰ˆæœ¬
                dmgSkill_NoCrit: dmgSkill_NoCrit.avg,
                dmgSkill_Crit: dmgSkill_Crit.avg,
                dmgSkill_Boss: dmgSkill_Boss.avg,
                dmgSkill_BossCrit: dmgSkill_BossCrit.avg
            });

            document.getElementById('recordName').value = '';
            renderCompareList();
        }

        function renderCompareList() {
            const emptyEl = document.getElementById('compareListEmpty');
            const scrollEl = document.getElementById('compareListScroll');
            const bodyEl = document.getElementById('compareListBody');

            if (compareList.length === 0) {
                emptyEl.style.display = 'block';
                scrollEl.style.display = 'none';
                baseItemId = null;
                return;
            }

            emptyEl.style.display = 'none';
            scrollEl.style.display = 'block';

            // å¦‚æœæ²’æœ‰è¨­å®šåŸºæº–ï¼Œæˆ–åŸºæº–é …ç›®å·²è¢«åˆªé™¤ï¼Œå‰‡ä½¿ç”¨ç¬¬ä¸€ç­†
            let baseItem = compareList.find(item => item.id === baseItemId);
            if (!baseItem) {
                baseItemId = compareList[0].id;
                baseItem = compareList[0];
            }

            let html = '';
            compareList.forEach((item, index) => {
                const isBase = item.id === baseItemId;
                const isNew = index === compareList.length - 1;

                const getDiff = (current, base) => {
                    if (isBase || base === 0) return '';
                    const diff = ((current - base) / base * 100).toFixed(1);
                    if (diff > 0) return `<br><span class="list-diff-positive">+${diff}%</span>`;
                    if (diff < 0) return `<br><span class="list-diff-negative">${diff}%</span>`;
                    return '';
                };

                const rowClass = isBase ? 'base-row' : (isNew ? 'highlight-row' : '');
                const baseLabel = isBase ? '<span class="base-indicator">åŸºæº–</span>' : '';
                const btnClass = isBase ? 'btn-set-base active' : 'btn-set-base';
                const btnText = isBase ? 'âœ“ åŸºæº–' : 'è¨­ç‚ºåŸºæº–';

                const maxStatsDisplay = item.isMaxStats ? `+${item.maxStatsPercent}%` : '-';
                const beastDisplay = item.isBeast ? `+${item.beastPercent}%` : '-';
                const reformDisplay = item.petReformLevel > 0 ? `${reformLabels[item.petReformLevel]} +${item.reformPercent}%` : 'æœªæ”¹';
                const weaponDisplay = item.hasWeapon ? 'æœ‰' : 'ç„¡';

                const shortReform = item.petReformLevel > 0 ? `${item.petReformLevel}æ”¹ +${item.reformPercent}%` : '-';

                html += `
                    <tr class="${rowClass}">
                        <td class="item-name" title="${item.name}">${item.name}${baseLabel}</td>
                        <td>${item.attack}/${item.defense}</td>
                        <td><span class="status-badge ${item.hasWeapon ? 'status-yes' : 'status-no'}">${weaponDisplay}</span></td>
                        <td>${item.crystalLabel}</td>
                        <td>${item.raceLabel}</td>
                        <td class="grade-${item.petGrade}">${gradeNames[item.petGrade]}</td>
                        <td><span class="status-badge ${item.isMaxStats ? 'status-yes' : 'status-no'}">${maxStatsDisplay}</span></td>
                        <td><span class="status-badge ${item.isBeast ? 'status-yes' : 'status-no'}">${beastDisplay}</span></td>
                        <td><span class="reform-badge reform-${item.petReformLevel}">${shortReform}</span></td>
                        <td><span class="skill-badge">${item.skillPercent}%</span></td>
                        <td class="dmg-cell">${item.dmgNA_NoCrit.toLocaleString()}${getDiff(item.dmgNA_NoCrit, baseItem.dmgNA_NoCrit)}</td>
                        <td class="dmg-cell">${item.dmgSkill_NoCrit.toLocaleString()}${getDiff(item.dmgSkill_NoCrit, baseItem.dmgSkill_NoCrit)}</td>
                        <td class="dmg-cell">${item.dmgNA_Crit.toLocaleString()}${getDiff(item.dmgNA_Crit, baseItem.dmgNA_Crit)}</td>
                        <td class="dmg-cell">${item.dmgSkill_Crit.toLocaleString()}${getDiff(item.dmgSkill_Crit, baseItem.dmgSkill_Crit)}</td>
                        <td class="dmg-cell">${item.dmgNA_Boss.toLocaleString()}${getDiff(item.dmgNA_Boss, baseItem.dmgNA_Boss)}</td>
                        <td class="dmg-cell">${item.dmgSkill_Boss.toLocaleString()}${getDiff(item.dmgSkill_Boss, baseItem.dmgSkill_Boss)}</td>
                        <td class="dmg-cell">${item.dmgNA_BossCrit.toLocaleString()}${getDiff(item.dmgNA_BossCrit, baseItem.dmgNA_BossCrit)}</td>
                        <td class="dmg-cell">${item.dmgSkill_BossCrit.toLocaleString()}${getDiff(item.dmgSkill_BossCrit, baseItem.dmgSkill_BossCrit)}</td>
                        <td>
                            <button class="${btnClass}" onclick="setAsBase(${item.id})">${btnText}</button>
                            <button class="btn-delete-item" onclick="removeFromList(${item.id})">âœ•</button>
                        </td>
                    </tr>
                `;
            });

            bodyEl.innerHTML = html;
        }

        function setAsBase(id) {
            baseItemId = id;
            renderCompareList();
        }

        function removeFromList(id) {
            compareList = compareList.filter(item => item.id !== id);
            renderCompareList();
        }

        function clearCompareList() {
            if (compareList.length === 0) return;
            if (confirm('ç¢ºå®šè¦æ¸…ç©ºæ‰€æœ‰æ¯”è¼ƒè¨˜éŒ„å—ï¼Ÿ')) {
                compareList = [];
                recordCounter = 1;
                renderCompareList();
            }
        }

        window.onload = function() { calculate(); };

        document.querySelectorAll('input:not(#recordName):not(#skillMultiplierInput):not(#skillMultiplierRange), select').forEach(el => {
            el.addEventListener('change', calculate);
            el.addEventListener('input', calculate);
        });
    </script>
</body>
</html>
